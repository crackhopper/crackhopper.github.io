<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="很早的文章啦。主要其实浅显讲了讲如何用 cmake 配置 opencv 库。\n当时其实比较深入的阅读了cmake的文档。不过在AI时代，不是那么有必要通读文档了。\n"><title>cmake入门</title><link rel=canonical href=https://crackhopper.github.io/2020/02/15/cmake%E5%85%A5%E9%97%A8/><link rel=stylesheet href=/scss/style.min.4d36f8dc1fd48129e1635deb4b8eb2870fa09474f7280c4cb606d40b2526994b.css><meta property='og:title' content="cmake入门"><meta property='og:description' content="很早的文章啦。主要其实浅显讲了讲如何用 cmake 配置 opencv 库。\n当时其实比较深入的阅读了cmake的文档。不过在AI时代，不是那么有必要通读文档了。\n"><meta property='og:url' content='https://crackhopper.github.io/2020/02/15/cmake%E5%85%A5%E9%97%A8/'><meta property='og:site_name' content='crackhopper的技术博客'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='cmake'><meta property='article:tag' content='build'><meta property='article:published_time' content='2020-02-15T20:48:22+08:00'><meta property='article:modified_time' content='2020-02-15T20:48:22+08:00'><meta name=twitter:title content="cmake入门"><meta name=twitter:description content="很早的文章啦。主要其实浅显讲了讲如何用 cmake 配置 opencv 库。\n当时其实比较深入的阅读了cmake的文档。不过在AI时代，不是那么有必要通读文档了。\n"><link rel=stylesheet href=/css/custom.css></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_337fe2b325ec916d.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>crackhopper的技术博客</a></h1><h2 class=site-description>C++, Graphics, Game, AI/ML</h2></div></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>文章</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于我</span></a></li><li><a href=/projects/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>项目</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky" id=right-sidebar><section class="widget archives toc-widget"><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc id=toc-content><nav id=TableOfContents><ul><li><a href=#简介>简介</a></li><li><a href=#编译一个可执行文件>编译一个可执行文件</a><ul><li><a href=#hello-world项目>Hello World项目</a><ul><li><a href=#简单的例子>简单的例子</a></li><li><a href=#构建helloworld>构建helloworld</a></li></ul></li><li><a href=#项目外构建>项目外构建</a></li></ul></li><li><a href=#编译一个静态库文件>编译一个静态库文件</a><ul><li><a href=#静态库机制>静态库机制</a></li><li><a href=#静态库项目>静态库项目</a></li></ul></li><li><a href=#编译一个动态库文件>编译一个动态库文件</a><ul><li><a href=#动态库机制>动态库机制</a></li><li><a href=#动态库项目>动态库项目</a></li></ul></li><li><a href=#引入库文件>引入库文件</a><ul><li><a href=#引入子模块>引入子模块</a></li><li><a href=#引入第三方库>引入第三方库</a></li><li><a href=#使用find_package>使用find_package</a></li></ul></li></ul></nav></div></section></aside><button class=toc-float-btn id=toc-float-btn aria-label=展开目录 title=展开目录>
<span class=toc-float-btn-icon></span></button><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/2020/02/15/cmake%E5%85%A5%E9%97%A8/>cmake入门</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2020-02-15T20:48:22+08:00>Feb 15, 2020</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>2 minute read</time></div></footer></div></header><section class=article-content><p>很早的文章啦。主要其实浅显讲了讲如何用 cmake 配置 opencv 库。</p><p>当时其实比较深入的阅读了cmake的文档。不过在AI时代，不是那么有必要通读文档了。</p><h1 id=简介>简介</h1><p>CMake是一个主要用来管理C++项目的工具。主要特点是：更好的解决C++项目跨平台编译带来的配置问题。</p><p>CMake提供很多实用的功能，本文简单介绍我项目里常用的一些特性。</p><p>如何安装CMake这里就不介绍了，可以自行搜索。安装好后要确保在命令行可以执行cmake命令。</p><h1 id=编译一个可执行文件>编译一个可执行文件</h1><h2 id=hello-world项目>Hello World项目</h2><p>CMake通过找寻目录下的 <code>CMakeLists.txt</code> 文件，读取文件里的内容对项目进行构建。使用方式是</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cmake &lt;project_dir&gt;
</span></span></code></pre></td></tr></table></div></div><p>其中 <code>&lt;project_dir></code> 是 <code>CMakeLists.txt</code> 所在的文件夹。cmake的工作流程如下：</p><ol><li>cmake读取 <code>&lt;project_dir></code> 文件夹下面的 <code>CMakeLists.txt</code> 文件。</li><li>执行平台解析，基础库解析，依赖库查找。如果有错误则暴露错误，如果成功则生成一系列用来构建的文件。其中最重要的一个文件叫 <code>Makefile</code> 。</li><li>用户通过执行 make ，读取 <code>Makefile</code> 对项目进行构建。</li></ol><h3 id=简单的例子>简单的例子</h3><p>看一个简单的例子，目录层级如下：</p><p><img src=/images/cmake-tutorial/hello-world.png loading=lazy alt=hello-world>
其中，两个文件的内容：</p><p><strong>helloworld.cpp</strong></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#57606a>#include&lt;iostream&gt;
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#cf222e>int</span> <span style=color:#6639ba>main</span><span style=color:#1f2328>(</span><span style=color:#cf222e>int</span> argc<span style=color:#1f2328>,</span> <span style=color:#cf222e>char</span> <span style=color:#0550ae>*</span>argv<span style=color:#1f2328>[]){</span>
</span></span><span style=display:flex><span>   std<span style=color:#0550ae>::</span>cout <span style=color:#0550ae>&lt;&lt;</span> <span style=color:#0a3069>&#34;Hello World!&#34;</span> <span style=color:#0550ae>&lt;&lt;</span> std<span style=color:#0550ae>::</span>endl<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>   <span style=color:#cf222e>return</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>CMakeLists</strong></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#6639ba>cmake_minimum_required</span><span style=color:#1f2328>(</span><span style=color:#0a3069>VERSION</span> <span style=color:#0a3069>2.8.9</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>project</span> <span style=color:#1f2328>(</span><span style=color:#0a3069>hello</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>add_executable</span><span style=color:#1f2328>(</span><span style=color:#0a3069>hello</span> <span style=color:#0a3069>helloworld.cpp</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span></code></pre></td></tr></table></div></div><p>这里解释一下 <code>CMakeLists.txt</code> 的内容。</p><ul><li>第1行指定最低的cmake版本</li><li>第2行指定项目名称</li><li>第3方添加一个任务，生成可执行文件 <code>hello</code> 。生成这个文件需要用到 <code>helloworld.cpp</code> 。</li><li>cmake不区分命令的大小写 。</li></ul><h3 id=构建helloworld>构建helloworld</h3><p><img src=/images/cmake-tutorial/make-hello-world-s.png loading=lazy alt=make-hello-world-s></p><p>解释一下：</p><ul><li><code>cmake .</code> 运行cmake命令，查找目录为 <code>.</code> (即当前目录) 。这个命令会生成一系列文件。包括一个重要的 <code>Makefile</code> 文件</li><li><code>make</code> 会在当前文件夹查找 <code>Makefile</code> 文件 ，然后对项目进行编译，最终产生了二进制 <code>hello</code></li><li><code>./hello</code> 运行这个编译好的二进制文件</li></ul><h2 id=项目外构建>项目外构建</h2><p>cmake提供了一个非常好用的特性，就是 <strong>项目外构建</strong> 。简单来说，cmake支持在自定义的位置对项目进行构建。这样就避免了构建时生成的临时文件把原本的项目弄的非常混乱。</p><p>比如说刚才的例子，我们在项目里创建一个build文件夹，在里面构建。</p><p><img src=/images/cmake-tutorial/out-build.png loading=lazy alt=out-build></p><p>构建好了之后:
<img src=/images/cmake-tutorial/out-build-res.png loading=lazy alt=out-build-res></p><p>我们可以看到生成的文件都在build文件夹中。进入到里面，进行make即可编译。</p><p><img src=/images/cmake-tutorial/out-build-make.png loading=lazy alt=out-build-make></p><h1 id=编译一个静态库文件>编译一个静态库文件</h1><h2 id=静态库机制>静态库机制</h2><p>说静态库首先要说什么是编译。</p><p>编译就是把 <strong>源代码</strong> 转化为 <strong>目标代码</strong> 的过程。而什么是 <strong>目标代码</strong> 呢？就是机器可以执行的二进制代码，一般来说都是要符合某种规范的，比如linux下的elf格式，windows下的pe格式。这里就不细展开了。</p><p>有的代码具备很强的通用性，比如计算绝对值的函数。我们希望在多个项目里都使用这个函数。那么一个方式就是把你的源代码编译成库文件 （也是一种二进制格式），当你写程序需要的时候，链接器可以 <strong>链接</strong> 到这个库文件中，找到对应函数的二进制，&ldquo;注入"到你写的程序中。</p><p>因此我们通常常见的项目构建都分两步：编译、链接。</p><ul><li>编译：负责源代码转换为目标代码</li><li>链接：负责找到程序的入口（main函数），并把二进制组装起来，生成可执行格式（elf或pe）</li></ul><p>那么如何把代码构建成一个静态库呢？</p><h2 id=静态库项目>静态库项目</h2><p>我们先看一下 <code>CMakeLists.txt</code> 的写法：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#6639ba>cmake_minimum_required</span><span style=color:#1f2328>(</span><span style=color:#0a3069>VERSION</span> <span style=color:#0a3069>2.8</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>project</span><span style=color:#1f2328>(</span><span style=color:#0a3069>abs</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>add_library</span><span style=color:#1f2328>(</span><span style=color:#0a3069>abs</span> <span style=color:#0a3069>STATIC</span> <span style=color:#0a3069>abs.cpp</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span></code></pre></td></tr></table></div></div><p>对应的cpp文件如下</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#cf222e>double</span> <span style=color:#6639ba>abs</span><span style=color:#1f2328>(</span><span style=color:#cf222e>double</span> v<span style=color:#1f2328>){</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>return</span> v<span style=color:#0550ae>&gt;</span><span style=color:#0550ae>0</span> <span style=color:#0550ae>?</span> <span style=color:#900;font-weight:700>v</span> <span style=color:#1f2328>:</span> <span style=color:#0550ae>-</span>v<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>我们尝试构建一下：
<img src=/images/cmake-tutorial/static-lib-s.png loading=lazy alt=static-lib-s></p><p>构建后的结果：
<img src=/images/cmake-tutorial/static-lib-res.png loading=lazy alt=static-lib-res></p><p>注意到，libabs.a文件，即为我们构造出的静态库文件。</p><h1 id=编译一个动态库文件>编译一个动态库文件</h1><h2 id=动态库机制>动态库机制</h2><p>静态库引入代码复用的能力后，有一个新的问题出现了：比如abs代码，在多个程序里都有使用，而且这多个程序可能都在系统上执行，这样abs的代码就被系统内存加载了多次。这无疑是一种浪费。</p><p>动态库提供了一种机制：库的代码并不会"注入"到编译产出的二进制文件中，而是由操作系统加载对应的库，在程序加载到内存的过程中，操作系统自动把对应的动态库调用进行重定向。这样abs的代码只会在内存中出现一次。</p><p>动态库技术是一个非常广泛使用的技术，操作系统大部分的api都是通过动态库提供的。</p><p>构建动态库和构建静态库一样简单。我们看一下例子：</p><h2 id=动态库项目>动态库项目</h2><p>延用静态库的例子，我们只需要把 <code>CMakeLists.txt</code> 修改一下即可。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#6639ba>cmake_minimum_required</span><span style=color:#1f2328>(</span><span style=color:#0a3069>VERSION</span> <span style=color:#0a3069>2.8</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>project</span><span style=color:#1f2328>(</span><span style=color:#0a3069>abs</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>add_library</span><span style=color:#1f2328>(</span><span style=color:#0a3069>abs</span> <span style=color:#0a3069>SHARED</span> <span style=color:#0a3069>abs.cpp</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span></code></pre></td></tr></table></div></div><p>构造的结果会产生一个 <code>libabs.so</code> 文件。读者可以自行尝试一下。</p><p>如果要同时构建静态库和动态库，cmake的写法需要一点技巧：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#6639ba>cmake_minimum_required</span><span style=color:#1f2328>(</span><span style=color:#0a3069>VERSION</span> <span style=color:#0a3069>2.8</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>project</span><span style=color:#1f2328>(</span><span style=color:#0a3069>abs</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>add_library</span><span style=color:#1f2328>(</span><span style=color:#0a3069>abs</span> <span style=color:#0a3069>SHARED</span> <span style=color:#0a3069>abs.cpp</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>add_library</span><span style=color:#1f2328>(</span><span style=color:#0a3069>abs_static</span> <span style=color:#0a3069>STATIC</span> <span style=color:#0a3069>abs.cpp</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>set_target_properties</span><span style=color:#1f2328>(</span><span style=color:#0a3069>abs_static</span> <span style=color:#0a3069>PROPERTIES</span> <span style=color:#0a3069>OUTPUT_NAME</span> <span style=color:#0a3069>&#34;abs&#34;</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span></code></pre></td></tr></table></div></div><p>这是因为cmake中不允许target有相同的名字，所以我们需要用不同的名字，同时修改target的输出。</p><h1 id=引入库文件>引入库文件</h1><h2 id=引入子模块>引入子模块</h2><p>使用 <code>add_subdirectory</code> 函数，可以把子文件夹中的 <code>CMakeLists.txt</code> 引入到当前 <code>CMakeLists.txt</code> 中。</p><p>举个例子：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#6639ba>cmake_minimum_required</span><span style=color:#1f2328>(</span><span style=color:#0a3069>VERSION</span> <span style=color:#0a3069>2.8</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>project</span><span style=color:#1f2328>(</span><span style=color:#0a3069>helloworld</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>include_directories</span><span style=color:#1f2328>(</span><span style=color:#0a3069>./</span> <span style=color:#0a3069>./hello</span> <span style=color:#0a3069>./world</span><span style=color:#1f2328>)</span><span style=color:#57606a>#添加多目录的路径
</span></span></span><span style=display:flex><span><span style=color:#57606a># Add block directories
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#6639ba>add_subdirectory</span><span style=color:#1f2328>(</span><span style=color:#0a3069>hello</span><span style=color:#1f2328>)</span><span style=color:#57606a>#添加hello文件夹中的hello库
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#6639ba>add_subdirectory</span><span style=color:#1f2328>(</span><span style=color:#0a3069>world</span><span style=color:#1f2328>)</span><span style=color:#57606a>#添加world文件夹中的world库
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>add_executable</span><span style=color:#1f2328>(</span><span style=color:#0a3069>helloworld</span> <span style=color:#0a3069>main.cpp</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#57606a>#将多目录下的hello库和world库链接上可执行文件
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#6639ba>target_link_libraries</span><span style=color:#1f2328>(</span><span style=color:#0a3069>helloworld</span> <span style=color:#0a3069>hello</span> <span style=color:#0a3069>world</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span></code></pre></td></tr></table></div></div><p>解释：</p><ul><li><code>add_subdirectory</code> 会把对应文件夹中的 <code>CMakeLists.txt</code> 引入进来，包括内部的target。这里假定了 <code>hello</code> 文件夹的target是 <code>hello</code> ， 这里假定了 <code>world</code> 文件夹的target是 <code>world</code> 。</li><li><code>target_link_libraries</code> 用来对 <code>helloworld</code> 这个target进行更多的描述：描述这个target完成过程中，需要对 <code>hello</code> 以及 <code>world</code> 两个target进行链接（这两个target必须是库）</li></ul><p>完整的目录结构：
<img src=/images/cmake-tutorial/multi-cmake.png loading=lazy alt=multi-cmake></p><h2 id=引入第三方库>引入第三方库</h2><p>由于大量开源模块都是使用cmake进行构建的，因此存在大量的开源脚本方便你快速把第三方库引入到你的项目里。</p><p>我们这里以引入opencv为例。</p><p>编写一个使用opencv的程序， <code>hello_cv.cpp</code> 。</p><ul><li>复制官方文档的代码：https://docs.opencv.org/3.2.0/d0/d2a/contours2_8cpp-example.html</li></ul><p>想要让这个程序运行起来，有以下几个条件：</p><ul><li>本地需要安装opencv开发环境。使用命令 <code>sudo apt-get install libopencv-dev</code></li><li>检测opencv是否安装成功 <code>dpkg -L libopencv-dev</code> 。这个命令会显示上面安装的包里的文件都被安装到什么位置了。在我的系统里，文件主要被安装在 <code>/usr/bin</code> , <code>/usr/include</code> , <code>/usr/lib/x86_64-linux-gnu</code>, <code>/usr/share/OpenCV</code> 这几个文件夹中。</li></ul><p>接着，我们创建cmake配置文件：</p><ul><li>告诉cmake去那里找头文件，显然是要在 <code>/usr/include</code> 里找</li><li>告诉cmake去那里找库文件，显然是要在 <code>/usr/lib/x86_64-linux-gnu</code> 里找</li><li>告诉cmake应该链接哪些库文件，显然是 <code>libopencv_core.so</code> 、 <code>libopencv_highgui.so</code> 和 <code>libopencv_imgproc.so</code></li></ul><p>于是我们的 <code>CMakeLists.txt</code> 如下：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#6639ba>cmake_minimum_required</span><span style=color:#1f2328>(</span><span style=color:#0a3069>VERSION</span> <span style=color:#0a3069>2.8</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>project</span><span style=color:#1f2328>(</span><span style=color:#0a3069>hellocv</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#57606a># 指定查找头文件的目录                                                                                                                                 
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#6639ba>include_directories</span><span style=color:#1f2328>(</span><span style=color:#0a3069>/usr/include</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#57606a># 指定查找库文件的目录                                                                                                                                 
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#6639ba>link_directories</span><span style=color:#1f2328>(</span><span style=color:#0a3069>/usr/lib/x86_64-linux</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#57606a># 指定项目的target，产生一个二进制                                                                                                                     
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#6639ba>add_executable</span><span style=color:#1f2328>(</span><span style=color:#0a3069>hellocv</span> <span style=color:#0a3069>hello_cv.cpp</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#57606a># 指定链接库，优先链接动态库                                                                                                                           
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#6639ba>target_link_libraries</span><span style=color:#1f2328>(</span><span style=color:#0a3069>hellocv</span> <span style=color:#0a3069>opencv_core</span> <span style=color:#0a3069>opencv_highgui</span> <span style=color:#0a3069>opencv_imgproc</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span></code></pre></td></tr></table></div></div><p>最后得到的结果：
<img src=/images/cmake-tutorial/opencv.png loading=lazy alt=opencv></p><p>运行结果：
<img src=/images/cmake-tutorial/opencv-demo.png loading=lazy alt=opencv-demo></p><h2 id=使用find_package>使用find_package</h2><p>引入opencv非常容易，但有一个新问题。不同的平台上，opencv的安装地址可能不一样。如何才能更加通用的探测各个平台的opencv，并正确的链接呢？</p><p>cmake为了解决这个问题，要求所有兼容cmake的包，都编写对应的cmake模块。比如opencv包安装文件，就包含了对应的cmake模块：
<img src=/images/cmake-tutorial/opencv-cmake-s.png loading=lazy alt=opencv-cmake-s></p><p>这里的.cmake文件被安装到 <code>/usr/share</code> 文件夹下。这个是cmake会搜索模块的路径之一。</p><ul><li>具体参见：https://cmake.org/cmake/help/v3.0/command/find_package.html</li></ul><p>因此，我们只需要很简单的修改我们的cmake文件：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#6639ba>cmake_minimum_required</span><span style=color:#1f2328>(</span><span style=color:#0a3069>VERSION</span> <span style=color:#0a3069>2.8</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>project</span><span style=color:#1f2328>(</span><span style=color:#0a3069>hellocv</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#57606a># 根据 OpenCVConfig.cmake 里面的注释，可以知道用法：
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#6639ba>find_package</span><span style=color:#1f2328>(</span><span style=color:#0a3069>OpenCV</span> <span style=color:#0a3069>REQUIRED</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>include_directories</span><span style=color:#1f2328>(</span><span style=color:#0550ae>${</span><span style=color:#953800>OpenCV_INCLUDE_DIRS</span><span style=color:#0550ae>}</span><span style=color:#1f2328>)</span> <span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#57606a># 指定二进制和链接库
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#6639ba>add_executable</span><span style=color:#1f2328>(</span><span style=color:#0a3069>hellocv</span> <span style=color:#0a3069>hello_cv.cpp</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e></span><span style=color:#6639ba>target_link_libraries</span><span style=color:#1f2328>(</span><span style=color:#0a3069>hellocv</span> <span style=color:#0550ae>${</span><span style=color:#953800>OpenCV_LIBS</span><span style=color:#0550ae>}</span><span style=color:#1f2328>)</span><span style=color:#f6f8fa;background-color:#82071e>
</span></span></span></code></pre></td></tr></table></div></div><p>这样即保证了跨平台，又很简单。赶快试一下吧！</p></section><footer class=article-footer><section class=article-tags><a href=/tags/cmake/>Cmake</a>
<a href=/tags/build/>Build</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=[".main-article",".widget--toc"];e.forEach(e=>{const t=document.querySelector(e);t&&renderMathInElement(t,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})})</script></article><footer class=site-footer><section class=copyright>&copy;
2025 crackhopper的技术博客</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.32.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.0fcb739c1f88ce461c9640077fd21d8ce903946f1aef209dd01192827d26a90c.js defer></script><script type=text/javascript src=/ts/custom.fb6397326fc458b8ae775aee18e0a0ae80628aec9c216e7e90c79bb0486cb0e3.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>