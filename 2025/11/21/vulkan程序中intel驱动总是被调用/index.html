<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="这篇文章是闲暇时候的探索，并没有真正解决问题。\n"><title>Vulkan程序中Intel驱动总是被调用</title><link rel=canonical href=https://crackhopper.github.io/2025/11/21/vulkan%E7%A8%8B%E5%BA%8F%E4%B8%ADintel%E9%A9%B1%E5%8A%A8%E6%80%BB%E6%98%AF%E8%A2%AB%E8%B0%83%E7%94%A8/><link rel=stylesheet href=/scss/style.min.4d36f8dc1fd48129e1635deb4b8eb2870fa09474f7280c4cb606d40b2526994b.css><meta property='og:title' content="Vulkan程序中Intel驱动总是被调用"><meta property='og:description' content="这篇文章是闲暇时候的探索，并没有真正解决问题。\n"><meta property='og:url' content='https://crackhopper.github.io/2025/11/21/vulkan%E7%A8%8B%E5%BA%8F%E4%B8%ADintel%E9%A9%B1%E5%8A%A8%E6%80%BB%E6%98%AF%E8%A2%AB%E8%B0%83%E7%94%A8/'><meta property='og:site_name' content='crackhopper的技术博客'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='vulkan'><meta property='article:tag' content='intel'><meta property='article:tag' content='debug'><meta property='article:tag' content='windbg'><meta property='article:published_time' content='2025-11-21T12:53:06+08:00'><meta property='article:modified_time' content='2025-11-21T12:53:06+08:00'><meta name=twitter:title content="Vulkan程序中Intel驱动总是被调用"><meta name=twitter:description content="这篇文章是闲暇时候的探索，并没有真正解决问题。\n"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column compact"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_337fe2b325ec916d.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>crackhopper的技术博客</a></h1><h2 class=site-description>C++, Graphics, Game, AI/ML</h2></div></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>文章</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于我</span></a></li><li><a href=/notes/><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>笔记</span></a></li><li><a href=/projects/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>项目</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/2025/11/21/vulkan%E7%A8%8B%E5%BA%8F%E4%B8%ADintel%E9%A9%B1%E5%8A%A8%E6%80%BB%E6%98%AF%E8%A2%AB%E8%B0%83%E7%94%A8/>Vulkan程序中Intel驱动总是被调用</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-11-21T12:53:06+08:00>Nov 21, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><p>这篇文章是闲暇时候的探索，并没有真正解决问题。</p><h2 id=正文开始>正文开始</h2><p>之前调试神秘日志的时候，打印堆栈和文件操作，发现有大量intel驱动程序的调用，并且打开了特别多的文件。不知道为什么。</p><p>我们这次也深入研究一下。先手动在程序中设定环境变量： （环境变量设定笔记：TODO ）</p><p>这里罗列一下代码：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#57606a>#include</span> <span style=color:#57606a>&#34;utils.h&#34;</span><span style=color:#57606a>
</span></span></span><span style=display:flex><span><span style=color:#57606a>#ifdef _WIN32
</span></span></span><span style=display:flex><span><span style=color:#57606a>#include</span> <span style=color:#57606a>&lt;windows.h&gt;</span><span style=color:#57606a>
</span></span></span><span style=display:flex><span><span style=color:#57606a>#else
</span></span></span><span style=display:flex><span><span style=color:#57606a>#include</span> <span style=color:#57606a>&lt;stdlib.h&gt;</span><span style=color:#57606a>
</span></span></span><span style=display:flex><span><span style=color:#57606a>#endif
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>
</span></span><span style=display:flex><span><span style=color:#cf222e>void</span> <span style=color:#6639ba>expSetEnvVK</span><span style=color:#1f2328>()</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#ifdef _WIN32
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>  SetEnvironmentVariableW<span style=color:#1f2328>(</span><span style=color:#0a3069>L</span><span style=color:#0a3069>&#34;VK_LOADER_LAYERS_DISABLE&#34;</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>L</span><span style=color:#0a3069>&#34;~implicit~&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#else
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>  setenv<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;VK_LOADER_LAYERS_DISABLE&#34;</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>&#34;~implicit~&#34;</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#endif
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>检查环境变量是否设定成功，等程序完成该函数的调用后，执行下面命令查看进程环境变量：</p><pre tabindex=0><code>!peb
</code></pre><p>不过，即使设定了环境变量，我们断点</p><pre tabindex=0><code>bp KERNELBASE!CreateFileW &#34;r rcx; du @rcx; k L3; g&#34;
</code></pre><p>日志目前不产生了。但是，仍然会有大量的打开文件操作。</p><p>从堆栈可以看出：</p><pre tabindex=0><code>[0x0]   igvk64!ctlTemperatureGetState+0x73ea6a   0xcb4b753750   0x7ff9329718a0   
[0x1]   igvk64!ctlTemperatureGetState+0x73c020   0xcb4b753b40   0x7ff93296ecfb   
[0x2]   igvk64!ctlTemperatureGetState+0x73947b   0xcb4b753ce0   0x7ff93296e00b   
[0x3]   igvk64!ctlTemperatureGetState+0x73878b   0xcb4b753d20   0x7ff932964276   
[0x4]   igvk64!ctlTemperatureGetState+0x72e9f6   0xcb4b753d70   0x7ff93211040f   
[0x5]   igvk64!DumpRegistryKeyDefinitions+0x1c605f   0xcb4b753ee0   0x7ff9321007fb   
[0x6]   igvk64!DumpRegistryKeyDefinitions+0x1b644b   0xcb4b7544e0   0x7ff9320e76a4   
[0x7]   igvk64!DumpRegistryKeyDefinitions+0x19d2f4   0xcb4b754650   0x7ff9320d1bd5   
[0x8]   igvk64!DumpRegistryKeyDefinitions+0x187825   0xcb4b754700   0x7ff9320431e6   
[0x9]   igvk64!DumpRegistryKeyDefinitions+0xf8e36   0xcb4b754750   0x7ff932027534   
[0xa]   igvk64!DumpRegistryKeyDefinitions+0xdd184   0xcb4b76b960   0x7ff931ffec7d   
[0xb]   igvk64!DumpRegistryKeyDefinitions+0xb48cd   0xcb4b76b9d0   0x7ff931f80ca5   
[0xc]   igvk64!DumpRegistryKeyDefinitions+0x368f5   0xcb4b76ba20   0x7ff9378dc6dc   
[0xd]   vulkan_1!vkResetEvent+0x4b14c   0xcb4b76baf0   0x7ff9378c3652   
[0xe]   vulkan_1!vkResetEvent+0x320c2   0xcb4b76bc50   0x7ff9378e751e   
[0xf]   vulkan_1!vkResetEvent+0x55f8e   0xcb4b76be40   0x7ff630566b2f   
[0x10]   VulkanGLFWDemo+0x6b2f   0xcb4b76f250   0x7ff630567e80   
</code></pre><p>因为是release外加关闭了implicit layers。所以没有任何validation layers干扰。但是，vulkan还是会产生大量 igvk64模块的调用。</p><h2 id=ai解释>AI解释</h2><p><code>igvk64</code> 很可能是 Intel 的 Vulkan ICD / 驱动相关模块（或 Intel GPU 的 Vulkan 支持库/监控库）。Vulkan loader 在进程初始化 / 创建实例时会把系统里注册的所有 ICD（以及某些层）都载入并初始化——因此即便你最后用的是 NVIDIA 的物理设备，Intel 的 ICD 也可能会被加载并执行初始化代码（查询注册表、查询温度/设备信息、打开设备/日志文件等），这就会看到大量 <code>CreateFileW</code> / 注册表读取 等操作，堆栈里就会出现 <code>igvk64</code> 的函数。</p><p><strong>关于ICD机制，更多参见：</strong> <a class=link href=/notes/vulkan%E7%9A%84icd%E6%9C%BA%E5%88%B6/>Vulkan的ICD机制</a></p><h2 id=手动加载icd后>手动加载ICD后</h2><p>新增环境变量设定：</p><pre tabindex=0><code>VK_DRIVER_FILES=C:\WINDOWS\System32\DriverStore\FileRepository\nvmi.inf_amd64_c6ae241e95feb82d\nv-vk64.json
</code></pre><p>代码的方式：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#57606a>#include</span> <span style=color:#57606a>&#34;utils.h&#34;</span><span style=color:#57606a>
</span></span></span><span style=display:flex><span><span style=color:#57606a>#ifdef _WIN32
</span></span></span><span style=display:flex><span><span style=color:#57606a>#include</span> <span style=color:#57606a>&lt;windows.h&gt;</span><span style=color:#57606a>
</span></span></span><span style=display:flex><span><span style=color:#57606a>#else
</span></span></span><span style=display:flex><span><span style=color:#57606a>#include</span> <span style=color:#57606a>&lt;stdlib.h&gt;</span><span style=color:#57606a>
</span></span></span><span style=display:flex><span><span style=color:#57606a>#endif
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>
</span></span><span style=display:flex><span><span style=color:#cf222e>void</span> <span style=color:#6639ba>expSetEnvVK</span><span style=color:#1f2328>()</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#ifdef _WIN32
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>  SetEnvironmentVariableW<span style=color:#1f2328>(</span>
</span></span><span style=display:flex><span>      <span style=color:#0a3069>L</span><span style=color:#0a3069>&#34;VK_DRIVER_FILES&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>      LR<span style=color:#0a3069>&#34;(C:\WINDOWS\System32\DriverStore\FileRepository</span><span style=color:#0a3069>\n</span><span style=color:#0a3069>vmi.inf_amd64_c6ae241e95feb82d</span><span style=color:#0a3069>\n</span><span style=color:#0a3069>v-vk64.json)&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  SetEnvironmentVariableW<span style=color:#1f2328>(</span><span style=color:#0a3069>L</span><span style=color:#0a3069>&#34;VK_LOADER_LAYERS_DISABLE&#34;</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>L</span><span style=color:#0a3069>&#34;~implicit~&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#else
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>  setenv<span style=color:#1f2328>(</span>
</span></span><span style=display:flex><span>      <span style=color:#0a3069>&#34;VK_DRIVER_FILES&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>      R<span style=color:#0a3069>&#34;(C:\WINDOWS\System32\DriverStore\FileRepository</span><span style=color:#0a3069>\n</span><span style=color:#0a3069>vmi.inf_amd64_c6ae241e95feb82d</span><span style=color:#0a3069>\n</span><span style=color:#0a3069>v-vk64.json)&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>1</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>  setenv<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;VK_LOADER_LAYERS_DISABLE&#34;</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>&#34;~implicit~&#34;</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#endif
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>测试结果：设定成功后</p><ol><li>产生大量 nvogl的调用（这个可能符合预期）</li></ol><pre tabindex=0><code>[0x0]   KERNEL32!CreateFileW   0xc5662fabc8   0x7ff908effb25   
[0x1]   nvoglv64!vk_icdNegotiateLoaderICDInterfaceVersion+0xcc8a5   0xc5662fabd0   0x7ff908f00511   
[0x2]   nvoglv64!vk_icdNegotiateLoaderICDInterfaceVersion+0xcd291   0xc5662fac30   0x7ff90843a853   
[0x3]   nvoglv64+0xdaa853   0xc5662facb0   0x7ff90843a8b6   
[0x4]   nvoglv64+0xdaa8b6   0xc5662fafc0   0x7ff90843a8b6   
[0x5]   nvoglv64+0xdaa8b6   0xc5662fb2d0   0x7ff908439f6a   
[0x6]   nvoglv64+0xda9f6a   0xc5662fb5e0   0x7ff90843ae26   
[0x7]   nvoglv64+0xdaae26   0xc5662fb630   0x7ff90843acb9   
[0x8]   nvoglv64+0xdaacb9   0xc5662fb680   0x7ff90843a6fe   
[0x9]   nvoglv64+0xdaa6fe   0xc5662fb6d0   0x7ff9084385cb   
[0xa]   nvoglv64+0xda85cb   0xc5662fb700   0x7ff908dcca46   
[0xb]   nvoglv64!vkGetInstanceProcAddr+0x94276   0xc5662fb760   0x7ff908dcaf50   
[0xc]   nvoglv64!vkGetInstanceProcAddr+0x92780   0xc5662fb9e0   0x7ff908dc7e46   
[0xd]   nvoglv64!vkGetInstanceProcAddr+0x8f676   0xc5662fba30   0x7ff908dc8e4a   
[0xe]   nvoglv64!vkGetInstanceProcAddr+0x9067a   0xc5662fc1c0   0x7ff908dc7b6c   
[0xf]   nvoglv64!vkGetInstanceProcAddr+0x8f39c   0xc5662fc200   0x7ff93b99c6dc   
[0x10]   vulkan_1!vkResetEvent+0x4b14c   0xc5662fc230   0x7ff93b983652   
[0x11]   vulkan_1!vkResetEvent+0x320c2   0xc5662fc380   0x7ff93b9a751e   
[0x12]   vulkan_1!vkResetEvent+0x55f8e   0xc5662fc570   0x7ff6972b6b33   
[0x13]   VulkanGLFWDemo+0x6b33   0xc5662ff980   0x7ff6972b7e80   
[0x14]   VulkanGLFWDemo+0x7e80   0xc5662ffac0   0x7ff6972b95d4   
[0x15]   VulkanGLFWDemo+0x95d4   0xc5662ffc30   0x7ff6972ba2bf   
[0x16]   VulkanGLFWDemo+0xa2bf   0xc5662ffc80   0x7ff6972cb54c   
[0x17]   VulkanGLFWDemo+0x1b54c   0xc5662ffe70   0x7ffa4389e8d7   
[0x18]   KERNEL32!BaseThreadInitThunk+0x17   0xc5662ffeb0   0x7ffa4520c53c   
[0x19]   ntdll!RtlUserThreadStart+0x2c   0xc5662ffee0   0x0   
</code></pre><ol start=2><li>还会产生intel的驱动调用：</li></ol><pre tabindex=0><code>000001b2`2e445620  &#34;C:\Users\develop\AppData\LocalLo&#34;
000001b2`2e445660  &#34;w\Intel\ShaderCache\42c265904c15&#34;
000001b2`2e4456a0  &#34;3bce841ce64ab3cda0f27c76e6b1e7c0&#34;
000001b2`2e4456e0  &#34;efcc9de2f1082fe2a43e&#34;
 # Child-SP          RetAddr               Call Site
00 00000005`274fdb08 00007ffa`0324e16a     KERNEL32!CreateFileW
01 00000005`274fdb10 00007ffa`0324b720     igxelpicd64!DumpRegistryKeyDefinitions+0xb43aa
02 00000005`274fdf00 00007ffa`03248cfb     igxelpicd64!DumpRegistryKeyDefinitions+0xb1960
03 00000005`274fe0a0 00007ffa`0324800b     igxelpicd64!DumpRegistryKeyDefinitions+0xaef3b
04 00000005`274fe0e0 00007ffa`0323be16     igxelpicd64!DumpRegistryKeyDefinitions+0xae24b
05 00000005`274fe130 00007ffa`030fce7c     igxelpicd64!DumpRegistryKeyDefinitions+0xa2056
06 00000005`274fe2a0 00007ffa`030fb59e     igxelpicd64!DrvValidateVersion+0x13c57c
07 00000005`274fe870 00007ffa`030ee572     igxelpicd64!DrvValidateVersion+0x13ac9e
08 00000005`274fe8b0 00007ffa`02fbf6aa     igxelpicd64!DrvValidateVersion+0x12dc72
09 00000005`274fe8f0 00007ffa`2a8aacfe     igxelpicd64!DrvDescribePixelFormat+0x3a
0a 00000005`274fe940 00007ffa`2a8ed7e9     opengl32!_DescribeDriverPixelFormat+0x5a
0b 00000005`274fe980 00007ffa`2a886e9f     opengl32!LoadAvailableDrivers+0x3d9
0c 00000005`274fefe0 00007ff9`08d2005c     opengl32!wglDescribePixelFormat+0xdf
0d 00000005`274ff120 00007ff9`08d23622     nvoglv64!vk_optimusGetInstanceProcAddr+0x230ec
0e 00000005`274ff150 00007ff9`08d1cfd7     nvoglv64!vk_optimusGetInstanceProcAddr+0x266b2
0f 00000005`274ff1a0 00007ff9`3b9ad9cc     nvoglv64!vk_optimusGetInstanceProcAddr+0x20067
10 00000005`274ff1d0 00007ff9`3b9af465     vulkan_1!vkResetEvent+0x5c43c
11 00000005`274ff2c0 00007ff6`972b72e2     vulkan_1!vkResetEvent+0x5ded5
12 00000005`274ff300 00007ff6`972b7f29     VulkanGLFWDemo+0x72e2
13 00000005`274ff470 00007ff6`972b95d4     VulkanGLFWDemo+0x7f29
14 00000005`274ff5e0 00007ff6`972ba2bf     VulkanGLFWDemo+0x95d4
15 00000005`274ff630 00007ff6`972cb54c     VulkanGLFWDemo+0xa2bf
16 00000005`274ff820 00007ffa`4389e8d7     VulkanGLFWDemo+0x1b54c
17 00000005`274ff860 00007ffa`4520c53c     KERNEL32!BaseThreadInitThunk+0x17
18 00000005`274ff890 00000000`00000000     ntdll!RtlUserThreadStart+0x2c
</code></pre><h2 id=ai的解释>AI的解释</h2><h3 id=1-nvidia-optimusamd-switchable-graphics>1. NVIDIA Optimus/AMD Switchable Graphics</h3><p>您运行的系统几乎肯定是一个拥有<strong>集成显卡 (Intel)</strong> 和 <strong>独立显卡 (NVIDIA)</strong> 的笔记本电脑。</p><ul><li><p><strong>集成显卡 (Intel iGPU):</strong> 通常直接连接到显示器，负责低功耗下的桌面显示和简单图形渲染。</p></li><li><p><strong>独立显卡 (NVIDIA dGPU):</strong> 负责高性能渲染。</p></li></ul><p><strong>Optimus 的工作机制：</strong> NVIDIA 的 Optimus 技术允许应用程序启动时默认使用低功耗的 <strong>Intel iGPU</strong>。如果应用程序需要高性能（例如，一个 3D 游戏或 Vulkan/OpenGL 程序），NVIDIA 的驱动程序会<strong>拦截</strong>图形 API 调用，并将渲染工作交给 <strong>NVIDIA dGPU</strong> 完成。<strong>渲染完成后，dGPU 将结果帧通过 PCIe/内部总线复制回 iGPU 的帧缓冲区，再由 iGPU 将画面输出到显示器。</strong></p><h3 id=2-openglwgl-路径依赖->2. OpenGL/WGL 路径依赖 ⚠️</h3><p>您的堆栈跟踪（Stack Trace）清晰地显示了调用链经过了 <strong>OpenGL/WGL</strong> 的函数：</p><pre tabindex=0><code>09 00000005`274fe8f0 00007ffa`2a8aacfe igxelpicd64!DrvDescribePixelFormat+0x3a
0a 00000005`274fe940 00007ffa`2a8ed7e9 opengl32!_DescribeDriverPixelFormat+0x5a
0b 00000005`274fe980 00007ffa`2a886e9f opengl32!LoadAvailableDrivers+0x3d9
0c 00000005`274fefe0 00007ff9`08d2005c opengl32!wglDescribePixelFormat+0xdf
0d 00000005`274ff120 00007ff9`08d23622 nvoglv64!vk_optimusGetInstanceProcAddr+0x230ec
</code></pre><p><strong>关键点：</strong></p><ul><li>虽然您在使用 Vulkan (<code>vulkan_1.dll</code>), 但您的程序可能使用了像 <strong>GLFW</strong> 或类似的跨平台窗口库来创建窗口表面。</li><li>在 Windows 上，这些库在创建窗口或进行必要的初始化时，往往会调用 <strong>OpenGL/WGL</strong> 相关的函数（例如 <code>wglDescribePixelFormat</code>），即使目标是 Vulkan。</li><li>在 Optimus 系统上，这个 <strong>WGL 调用</strong> 默认被路由到 <strong>Intel iGPU 的驱动程序 (<code>igxelpicd64.dll</code>)</strong>，因为它是实际连接到显示器的。</li><li><code>igxelpicd64</code> 正在尝试访问 <strong>Intel 的 Shader Cache</strong> 路径 (<code>C:\Users\develop\AppData\LocalLow\Intel\ShaderCache\..</code>)。</li></ul><h3 id=3-vulkan-实例和物理设备分离>3. Vulkan 实例和物理设备分离</h3><p>您手动设置 <code>VK_DRIVER_FILES</code> 只影响了 Vulkan <strong>实例 (Instance)</strong> 的创建过程，确保 NVIDIA 的 ICD 驱动程序被加载。</p><ul><li><p><strong><code>vkCreateInstance</code> 成功：</strong> NVIDIA 驱动（<code>nvoglv64.dll</code>）被成功加载并初始化。</p></li><li><p><strong>后续步骤：</strong> 即使 NVIDIA 驱动被加载，当程序调用 <code>vkEnumeratePhysicalDevices</code> 时，它会发现 <strong>系统上的所有 Vulkan 兼容设备</strong>，包括 Intel iGPU 和 NVIDIA dGPU。</p></li><li><p><strong>Optimus 干预：</strong> 如上所述，在窗口和上下文的初始化过程中，<strong>OpenGL/WGL</strong> 的初始化路径（即使不是最终的 Vulkan 渲染路径）依然可能被 Intel 驱动程序介入，因为它管理着显示输出。</p></li></ul><h3 id=解决方案>解决方案</h3><p>在您的代码中添加一个全局导出变量，告诉 NVIDIA 驱动程序，您的程序是一个高性能应用，应该使用 dGPU。</p><p>在您的任何 .cpp 文件（最好是 main 所在的源文件）的全局作用域内添加以下代码：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#57606a>// 告诉 NVIDIA 驱动程序使用独立显卡 (dGPU)
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#cf222e>extern</span> <span style=color:#0a3069>&#34;C&#34;</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>__declspec</span><span style=color:#1f2328>(</span>dllexport<span style=color:#1f2328>)</span> DWORD NvOptimusEnablement <span style=color:#0550ae>=</span> <span style=color:#0550ae>0x00000001</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>// 告诉 AMD 驱动程序使用独立显卡 (dGPU) (可选)
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#cf222e>extern</span> <span style=color:#0a3069>&#34;C&#34;</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>__declspec</span><span style=color:#1f2328>(</span>dllexport<span style=color:#1f2328>)</span> <span style=color:#cf222e>int</span> AmdPowerXpressRequestHighPerformance <span style=color:#0550ae>=</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=添加高性能标记后>添加高性能标记后</h2><p>还是有大量intel驱动的调用：</p><pre tabindex=0><code>00000154`764574e0  &#34;C:\Users\develop\AppData\LocalLo&#34;
00000154`76457520  &#34;w\Intel\ShaderCache\5f11c2592227&#34;
00000154`76457560  &#34;90422146768d167662e6e467ee38e871&#34;
00000154`764575a0  &#34;11911336f4e1aec31b96&#34;
 # Child-SP          RetAddr               Call Site
00 0000000c`adafa1e8 00007ffa`35b172ea     KERNEL32!CreateFileW
01 0000000c`adafa1f0 00007ffa`35b148a0     igd10um64xe!OpenAdapter10_2+0x6935a
02 0000000c`adafa5e0 00007ffa`35b11d8b     igd10um64xe!OpenAdapter10_2+0x66910
03 0000000c`adafa780 00007ffa`35b1109b     igd10um64xe!OpenAdapter10_2+0x63dfb
04 0000000c`adafa7c0 00007ffa`35b07f56     igd10um64xe!OpenAdapter10_2+0x6310b
05 0000000c`adafa810 00007ffa`35a5874a     igd10um64xe!OpenAdapter10_2+0x59fc6
06 0000000c`adafa980 00007ffa`35a976d3     igd10um64xe!ctlInit+0x1d8a
07 0000000c`adafb040 00007ffa`35a9747f     igd10um64xe!ctlInit+0x40d13
08 0000000c`adafb0c0 00007ffa`3f94d011     igd10um64xe!ctlInit+0x40abf
09 0000000c`adafb0f0 00007ffa`3f94b512     d3d11!NDXGI::CDevice::CreateDriverInstance+0x271
0a 0000000c`adafb210 00007ffa`3f94af26     d3d11!CDevice::CreateDriverInstance+0xa2
0b 0000000c`adafb280 00007ffa`3f95d01b     d3d11!CContext::LUCCompleteLayerConstruction+0xc2
0c 0000000c`adafb3a0 00007ffa`3f95d602     d3d11!NOutermost::CDeviceChild::LUCCompleteLayerConstruction+0x5b
0d 0000000c`adafb400 00007ffa`3f95d1f6     d3d11!CUseCountedObject&lt;NOutermost::CDeviceChild&gt;::CUseCountedObject&lt;NOutermost::CDeviceChild&gt;+0x2a2
0e 0000000c`adafb490 00007ffa`3f9da7db     d3d11!NOutermost::CDevice::CreateLayeredChild+0x166
0f 0000000c`adafb5b0 00007ffa`3f94c72b     d3d11!CDevice::LLOCompleteLayerConstruction+0xafb
10 0000000c`adafbcb0 00007ffa`3f94fe14     d3d11!NDXGI::CDevice::LLOCompleteLayerConstruction+0xdf
11 0000000c`adafbf80 00007ffa`3f94ff1a     d3d11!NOutermost::CDevice::LLOCompleteLayerConstruction+0x14
12 0000000c`adafbfb0 00007ffa`3f94c561     d3d11!TComObject&lt;NOutermost::CDevice&gt;::TComObject&lt;NOutermost::CDevice&gt;+0xf6
13 0000000c`adafc020 00007ffa`3f94e8bb     d3d11!D3D11CreateLayeredDevice+0x231
14 0000000c`adafc120 00007ffa`3f94f2b7     d3d11!D3D11CoreCreateLayeredDevice+0x11b
15 0000000c`adafc1f0 00007ffa`3f94dabf     d3d11!D3D11RegisterLayersAndCreateDevice+0x57f
16 0000000c`adafc350 00007ffa`3f9bb073     d3d11!D3D11CoreCreateDevice+0x40f
17 0000000c`adafc670 00007ffa`3f9c22fe     d3d11!D3D11CreateDeviceAndSwapChainImpl+0x2a3
18 0000000c`adafc8e0 00007ffa`3f9c224c     d3d11!D3D11CreateDeviceAndSwapChain+0x9e
19 0000000c`adafc960 00007ffa`3f9c3b36     d3d11!D3D11CreateDeviceImpl+0x5c
1a 0000000c`adafc9d0 00007ffa`3f9d764b     d3d11!D3D11CreateDevice+0x86
1b 0000000c`adafca40 00007ffa`3fbf4692     d3d11!NDXGI::CDevice::EnsureChildDevice+0xdb
1c 0000000c`adafcad0 00007ffa`3fbbf76d     dxgi!CDXGISwapChain::EnsureChildDeviceInternal+0x6a
1d 0000000c`adafcda0 00007ffa`3fbc05a2     dxgi!CDXGISwapChain::PrepareWindowedBltPresent+0x72d
1e 0000000c`adafcec0 00007ffa`3fbb3674     dxgi!CDXGISwapChain::PresentImplCore+0x502
1f 0000000c`adafd870 00007ffa`3fbb2e1a     dxgi!CDXGISwapChain::PresentImpl+0x104
20 0000000c`adafd940 00007ff9`089965d3     dxgi!CDXGISwapChain::Present+0x17a
21 0000000c`adafdad0 00007ff9`089ca824     nvoglv64!DrvPresentBuffers+0x3553
22 0000000c`adafdb70 00007ff9`089a83f4     nvoglv64!DrvPresentBuffers+0x377a4
23 0000000c`adafde80 00007ff9`089cbef9     nvoglv64!DrvPresentBuffers+0x15374
24 0000000c`adafe390 00007ff9`08acb4ab     nvoglv64!DrvPresentBuffers+0x38e79
25 0000000c`adafe650 00007ff9`08ad807c     nvoglv64!DrvPresentBuffers+0x13842b
26 0000000c`adafe6f0 00007ff9`08aeeb75     nvoglv64!DrvPresentBuffers+0x144ffc
27 0000000c`adafe8b0 00007ff9`08964906     nvoglv64!DrvPresentBuffers+0x15baf5
28 0000000c`adafe990 00007ff9`08ab3bd1     nvoglv64!DrvValidateVersion+0x6db6
29 0000000c`adafe9e0 00007ff9`08a906cc     nvoglv64!DrvPresentBuffers+0x120b51
2a 0000000c`adaff270 00007ff9`08a8fb12     nvoglv64!DrvPresentBuffers+0xfd64c
2b 0000000c`adaff2a0 00007ff9`08d22259     nvoglv64!DrvPresentBuffers+0xfca92
2c 0000000c`adaff700 00007ff9`08d2456c     nvoglv64!vk_optimusGetInstanceProcAddr+0x252e9
2d 0000000c`adaff740 00007ff9`08d1e4ea     nvoglv64!vk_optimusGetInstanceProcAddr+0x275fc
2e 0000000c`adaffac0 00007ff9`08e2ff05     nvoglv64!vk_optimusGetInstanceProcAddr+0x2157a
2f 0000000c`adaffb10 00007ff6`53b47941     nvoglv64!vkGetInstanceProcAddr+0xf7735
30 0000000c`adaffcb0 00007ff6`53b4952e     VulkanGLFWDemo+0x7941
31 0000000c`adaffe70 00007ff6`53b42522     VulkanGLFWDemo+0x952e
32 0000000c`adaffec0 00007ffa`429e37b0     VulkanGLFWDemo+0x2522
33 0000000c`adaffef0 00007ffa`4389e8d7     ucrtbase!thread_start&lt;unsigned int (__cdecl*)(void *),1&gt;+0x30
34 0000000c`adafff20 00007ffa`4520c53c     KERNEL32!BaseThreadInitThunk+0x17
35 0000000c`adafff50 00000000`00000000     ntdll!RtlUserThreadStart+0x2c
</code></pre><p>仍然有从nvida驱动最终转发给 intel驱动的调用。</p><h2 id=ai解释-1>AI解释</h2><h3 id=核心结论窗口创建和显示管理>核心结论：窗口创建和显示管理</h3><p>即使您的最终渲染 API 是 Vulkan，您的程序在创建窗口和将 Vulkan 渲染结果<strong>呈现 (Present)</strong> 到屏幕时，仍需要依赖底层的 OS/窗口管理系统。</p><p>在 Windows 的双显卡系统上：</p><ol><li><p><strong>D3D11/DXGI 接口被调用：</strong> 许多现代窗口库（如 GLFW, SDL 等）在底层创建窗口表面时，或者为了与 Windows 的桌面合成管理器（DWM）更好地集成，会涉及到 D3D11 和 DXGI 的初始化路径。</p></li><li><p><strong>Intel 驱动拥有显示输出权：</strong> 由于 Intel iGPU 通常是<strong>直接连接</strong>到笔记本电脑显示器的，所以任何与 <strong>显示适配器 (Adapter)</strong> 相关的操作（如 DXGI 创建设备、枚举显示模式等），都会首先或默认涉及到 Intel 驱动程序（<code>igd10um64xe.dll</code>），因为它管理着最终的像素输出。</p></li><li><p><strong>着色器缓存访问：</strong> 在 D3D11/DXGI 初始化的过程中，Intel 驱动程序会执行标准操作，例如检查或创建其自身的着色器缓存目录 (<code>C:\Users\...\Intel\ShaderCache\</code>)。这表明 <strong>Intel 驱动程序被加载并运行了初始化逻辑</strong>。</p></li></ol><h3 id=方案尝试使用-vulkan-原生表面创建>方案：尝试使用 Vulkan 原生表面创建</h3><p>如果您使用的是 GLFW 或 SDL，尝试查看是否可以在 Vulkan 初始化阶段<strong>之前</strong>避免任何 WGL/DXGI 的调用。</p><p><strong>对于 GLFW 库：</strong></p><p>在调用 <code>glfwInit()</code> 之后、创建窗口之前，确保您明确告诉 GLFW <strong>不创建任何图形 API 上下文</strong>，这将有助于跳过 WGL/OpenGL 或 D3D/DXGI 的早期初始化。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#57606a>// 确保在创建窗口前设置以下提示
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>glfwWindowHint<span style=color:#1f2328>(</span>GLFW_CLIENT_API<span style=color:#1f2328>,</span> GLFW_NO_API<span style=color:#1f2328>);</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>// 创建窗口
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>GLFWwindow<span style=color:#0550ae>*</span> window <span style=color:#0550ae>=</span> glfwCreateWindow<span style=color:#1f2328>(</span>WIDTH<span style=color:#1f2328>,</span> HEIGHT<span style=color:#1f2328>,</span> <span style=color:#0a3069>&#34;Vulkan App&#34;</span><span style=color:#1f2328>,</span> <span style=color:#cf222e>nullptr</span><span style=color:#1f2328>,</span> <span style=color:#cf222e>nullptr</span><span style=color:#1f2328>);</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>目前AI提供的代码并没有用。因为目前出现问题的时候就是这么设置的。暂时卡在这里，后续可以考虑用windows原生API创建窗口，以及从堆栈看，可能d3d11可以做一些配置，避免其使用intel显卡</strong></p></section><footer class=article-footer><section class=article-tags><a href=/tags/vulkan/>Vulkan</a>
<a href=/tags/intel/>Intel</a>
<a href=/tags/debug/>Debug</a>
<a href=/tags/windbg/>Windbg</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=[".main-article",".widget--toc"];e.forEach(e=>{const t=document.querySelector(e);t&&renderMathInElement(t,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/notes/vulkan%E7%9A%84layer%E5%8F%91%E7%8E%B0%E6%9C%BA%E5%88%B6/><div class=article-details><h2 class=article-title>Vulkan的Layer发现机制</h2></div></a></article><article><a href=/notes/vulkan%E7%9A%84icd%E6%9C%BA%E5%88%B6/><div class=article-details><h2 class=article-title>Vulkan的ICD机制</h2></div></a></article><article><a href=/notes/windbg%E7%9A%84%E5%88%9D%E7%BA%A7%E7%94%A8%E6%B3%95/><div class=article-details><h2 class=article-title>WinDbg的初级用法</h2></div></a></article><article><a href=/2025/11/17/%E8%AE%B0%E5%BD%95%E8%B0%83%E8%AF%95vulkan%E7%A8%8B%E5%BA%8F%E6%89%93%E5%8D%B0%E5%A5%87%E6%80%AA%E6%97%A5%E5%BF%97%E7%9A%84%E9%97%AE%E9%A2%98/><div class=article-details><h2 class=article-title>记录调试Vulkan程序打印奇怪日志的问题</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2025 crackhopper的技术博客</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.32.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>