<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="\r继续深入 Vulkan 的绘制教程。当然我这里内容会比官方文档更深入一些。\n如标题所示，主要讲VB的使用。\n"><title>Vulkan入门02-VertexBuffers</title><link rel=canonical href=https://crackhopper.github.io/2025/11/27/vulkan%E5%85%A5%E9%97%A802-vertexbuffers/><link rel=stylesheet href=/scss/style.min.4d36f8dc1fd48129e1635deb4b8eb2870fa09474f7280c4cb606d40b2526994b.css><meta property='og:title' content="Vulkan入门02-VertexBuffers"><meta property='og:description' content="\r继续深入 Vulkan 的绘制教程。当然我这里内容会比官方文档更深入一些。\n如标题所示，主要讲VB的使用。\n"><meta property='og:url' content='https://crackhopper.github.io/2025/11/27/vulkan%E5%85%A5%E9%97%A802-vertexbuffers/'><meta property='og:site_name' content='crackhopper的技术博客'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='vulkan'><meta property='article:tag' content='vertexbuffer'><meta property='article:published_time' content='2025-11-27T22:17:18+08:00'><meta property='article:modified_time' content='2025-11-27T22:17:18+08:00'><meta name=twitter:title content="Vulkan入门02-VertexBuffers"><meta name=twitter:description content="\r继续深入 Vulkan 的绘制教程。当然我这里内容会比官方文档更深入一些。\n如标题所示，主要讲VB的使用。\n"><link rel=stylesheet href=/css/custom.css></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_337fe2b325ec916d.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>crackhopper的技术博客</a></h1><h2 class=site-description>C++, Graphics, Game, AI/ML</h2></div></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>文章</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于我</span></a></li><li><a href=/projects/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>项目</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky" id=right-sidebar><section class="widget archives toc-widget"><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc id=toc-content><nav id=TableOfContents><ul><li><a href=#顶点输入描述vertex-input-desciption>顶点输入描述(Vertex Input Desciption)</a><ul><li><a href=#vertex-shader的修改>Vertex Shader的修改</a></li><li><a href=#布局限定符>布局限定符</a><ul><li><a href=#location-限定符详解><code>location</code> 限定符详解</a></li><li><a href=#location-faq>location FAQ</a></li><li><a href=#cocos引擎中对应布局限定符>cocos引擎中对应布局限定符</a></li></ul></li><li><a href=#顶点数据定义>顶点数据定义</a></li><li><a href=#绑定描述-一组数据的读取方式>绑定描述 (一组数据的读取方式)</a></li><li><a href=#属性描述-单个数据内部的读取方式>属性描述 (单个数据内部的读取方式)</a></li><li><a href=#pipeline创建时>Pipeline创建时</a></li></ul></li><li><a href=#顶点缓冲区创建-vertex-buffer-creation>顶点缓冲区创建 (Vertex Buffer Creation)</a><ul><li><a href=#创建buffer对象>创建Buffer对象</a></li><li><a href=#内存需求memory-requirements>内存需求(Memory Requirements)</a></li><li><a href=#内存分配memory-allocation>内存分配(Memory Allocation)</a></li><li><a href=#填充顶点缓冲区-filling-the-vertex-buffer>填充顶点缓冲区 (Filling the Vertex Buffer)</a></li><li><a href=#绑定绘制-binding-the-vertex-buffer>绑定+绘制 (Binding the Vertex Buffer)</a></li><li><a href=#效果展示>效果展示</a></li></ul></li><li><a href=#暂存缓冲区staging-buffer>暂存缓冲区(Staging Buffer)</a><ul><li><a href=#传输队列transfer-queue>传输队列(Transfer queue)</a></li><li><a href=#重构>重构</a></li><li><a href=#使用暂存缓冲区>使用暂存缓冲区</a></li><li><a href=#总结>总结</a></li></ul></li><li><a href=#索引缓冲区index-buffer>索引缓冲区(Index Buffer)</a><ul><li><a href=#创建ib数据>创建IB数据</a></li><li><a href=#创建-indexbuffer>创建 IndexBuffer</a></li><li><a href=#使用indexbuffer>使用IndexBuffer</a></li><li><a href=#效果>效果</a></li></ul></li></ul></nav></div></section></aside><button class=toc-float-btn id=toc-float-btn aria-label=展开目录 title=展开目录>
<span class=toc-float-btn-icon></span></button><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/2025/11/27/vulkan%E5%85%A5%E9%97%A802-vertexbuffers/>Vulkan入门02-VertexBuffers</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-11-27T22:17:18+08:00>Nov 27, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>8 minute read</time></div></footer></div></header><section class=article-content><img src=/images/Vulkan%E5%85%A5%E9%97%A802-VertexBuffers-1764252524778.png alt=Vulkan入门02-VertexBuffers-1764252524778 width=574x430 loading=lazy><p>继续深入 Vulkan 的绘制教程。当然我这里内容会比官方文档更深入一些。</p><p>如标题所示，主要讲VB的使用。</p><h1 id=顶点输入描述vertex-input-desciption>顶点输入描述(Vertex Input Desciption)</h1><h2 id=vertex-shader的修改>Vertex Shader的修改</h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-glsl data-lang=glsl><span style=display:flex><span><span style=color:#57606a>#version 450</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec2</span> inPosition<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec3</span> inColor<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>out</span> <span style=color:#cf222e>vec3</span> fragColor<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>void</span> main<span style=color:#1f2328>()</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    gl_Position <span style=color:#0550ae>=</span> <span style=color:#cf222e>vec4</span><span style=color:#1f2328>(</span>inPosition<span style=color:#1f2328>,</span> <span style=color:#0550ae>0.0</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>1.0</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    fragColor <span style=color:#0550ae>=</span> inColor<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=布局限定符>布局限定符</h2><h3 id=location-限定符详解><code>location</code> 限定符详解</h3><p>在 GLSL 中，<code>location</code> 是一个 <strong>布局限定符 (layout qualifier)</strong>，用于显式地指定一个变量在内存或管道中的位置索引。它的主要作用是建立 <strong>CPU 端应用程序</strong> 与 <strong>GPU 端着色器</strong> 之间的数据连接。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-glsl data-lang=glsl><span style=display:flex><span>layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec2</span> inPosition<span style=color:#1f2328>;</span> <span style=color:#57606a>// 位置属性，索引为 0</span>
</span></span><span style=display:flex><span>layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec3</span> inColor<span style=color:#1f2328>;</span>    <span style=color:#57606a>// 颜色属性，索引为 1</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p><strong>用途:</strong></p><ul><li><code>in</code> (input) 变量是着色器从 <strong>顶点缓冲对象 (VBO)</strong> 中读取的数据。</li><li><strong>CPU 端</strong> (例如，使用 OpenGL 或 Vulkan API) 必须使用相同的索引来配置数据源。例如，当你在 CPU 端调用 <code>glVertexAttribPointer</code> 或 <code>vkCmdBindVertexBuffers</code> 时，你需要指定与 <code>location</code> 匹配的索引，告诉 GPU 哪个数据流对应着色器中的哪个输入变量。</li><li><strong>在您的代码中:</strong><ul><li><code>inPosition</code> 对应 <strong>索引 0</strong> 的顶点属性数据（通常是顶点坐标）。</li><li><code>inColor</code> 对应 <strong>索引 1</strong> 的顶点属性数据（通常是颜色值）。</li></ul></li></ul></li><li><p><strong>重要性:</strong> 确保 CPU/GPU 之间的数据对齐。如果不使用 <code>location</code>，编译器会自行分配，但显式指定可以提高 <strong>可移植性</strong> 和 <strong>调试效率</strong>。</p></li></ul><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-glsl data-lang=glsl><span style=display:flex><span>layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>out</span> <span style=color:#cf222e>vec3</span> fragColor<span style=color:#1f2328>;</span> <span style=color:#57606a>// 传递给片段着色器的颜色，索引为 0</span>
</span></span></code></pre></td></tr></table></div></div><p>这用于指定 <strong>顶点着色器</strong> 向 <strong>片段着色器 (Fragment Shader)</strong> 传递的变量的位置索引。这些变量在光栅化阶段会被 <strong>插值 (Interpolated)</strong>。</p><p><strong>用途:</strong></p><ul><li><code>out</code> (output) 变量是顶点着色器计算的结果，并将这些值传递给下一个阶段（通常是片段着色器）。</li><li><strong>连接机制:</strong> <strong>顶点着色器</strong> 中的 <code>out</code> 变量的 <code>location</code> 必须与 <strong>片段着色器</strong> 中相应 <code>in</code> 变量的 <code>location</code> <strong>匹配</strong>，才能正确连接数据流。</li></ul><h3 id=location-faq>location FAQ</h3><ul><li><strong>如果 顶点着色器有多个 out。都会被光栅化阶段插值么？</strong><ul><li>是的，通常情况下，顶点着色器中所有带 out 限定符的变量都会在光栅化阶段被插值 (Interpolated)。</li></ul></li><li><strong>有的变量会占用两个location，比如dvec3。为什么？</strong><ul><li>答案的核心在于 <strong>数据类型的大小</strong> 和 <strong>硬件的对齐规则</strong>，特别是针对 <strong>双精度浮点数 (Double-Precision Floating-Point, <code>double</code>)</strong>。</li><li>一个 <code>location</code> 通常被设计用来存储一个 <strong>4 字节</strong> 的基本单位，例如一个 <code>float</code>、一个 <code>int</code> 或一个 <code>vec4</code> 的一个分量。因此，一个标准的 <code>location</code> 槽位通常是 <strong>16 字节</strong> (即 4 个 4 字节的组件，如 <code>vec4</code>)。</li><li>而 <code>dvec3</code> ，由于双精度浮点数占用8字节，那么这个向量需要占用24字节，因此一个location就无法存下，它必须溢出到并占用下一个连续的 <code>location</code> 索引。</li></ul></li></ul><h3 id=cocos引擎中对应布局限定符>cocos引擎中对应布局限定符</h3><p>参看 <code>cocos-engine/editor/assets/chunks/shading-entries/data-structures/vs-input.chunk</code></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-glsl data-lang=glsl><span style=display:flex><span><span style=color:#57606a>//IA Input</span>
</span></span><span style=display:flex><span>layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec3</span> a_position<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec3</span> a_normal<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>2</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec2</span> a_texCoord<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#if CC_SURFACES_USE_TANGENT_SPACE</span>
</span></span><span style=display:flex><span>  layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>3</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec4</span> a_tangent<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#endif</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>#if CC_SURFACES_USE_VERTEX_COLOR</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec4</span> a_color<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#endif</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>// Attribute define should depend on system macro, not surface macro</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#if CC_SURFACES_USE_SECOND_UV || CC_USE_LIGHTMAP</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec2</span> a_texCoord1<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#endif</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>#if CC_USE_SKINNING</span>
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span><span style=color:#cf222e>if</span> __VERSION__ <span style=color:#0550ae>&gt;</span> <span style=color:#0550ae>310</span>
</span></span><span style=display:flex><span>    <span style=color:#57606a>// strictly speaking this should be u16vec4, but due to poor driver support</span>
</span></span><span style=display:flex><span>    <span style=color:#57606a>// somehow it seems we can get better results on many platforms using u32vec4</span>
</span></span><span style=display:flex><span>    layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>4</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>in</span> u32vec4 a_joints<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span><span style=color:#cf222e>else</span>
</span></span><span style=display:flex><span>    <span style=color:#f6f8fa;background-color:#82071e>#</span>pragma format<span style=color:#1f2328>(</span>RGBA16UI<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>    layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>4</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec4</span> a_joints<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span>endif
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>5</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec4</span> a_weights<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#endif</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>#if USE_INSTANCING</span>
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span><span style=color:#cf222e>if</span> CC_USE_BAKED_ANIMATION
</span></span><span style=display:flex><span>    <span style=color:#cf222e>in</span> <span style=color:#cf222e>highp</span> <span style=color:#cf222e>vec4</span> a_jointAnimInfo<span style=color:#1f2328>;</span> <span style=color:#57606a>// frameID, totalJoints, offset</span>
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span>endif
</span></span><span style=display:flex><span>  <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec4</span> a_matWorld0<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec4</span> a_matWorld1<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec4</span> a_matWorld2<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span><span style=color:#cf222e>if</span> CC_USE_LIGHTMAP
</span></span><span style=display:flex><span>    <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec4</span> a_lightingMapUVParam<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span>endif
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span><span style=color:#cf222e>if</span> CC_RECEIVE_SHADOW <span style=color:#0550ae>||</span> CC_USE_REFLECTION_PROBE
</span></span><span style=display:flex><span>    <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec4</span> a_localShadowBiasAndProbeId<span style=color:#1f2328>;</span> <span style=color:#57606a>// x:shadow bias, y:shadow normal bias, z: reflection probe id, w: blend reflection probe id</span>
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span>endif
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span><span style=color:#cf222e>if</span> CC_USE_REFLECTION_PROBE
</span></span><span style=display:flex><span>    <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec4</span> a_reflectionProbeData<span style=color:#1f2328>;</span> <span style=color:#57606a>// x:reflection probe blend weight</span>
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span>endif
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span><span style=color:#cf222e>if</span> CC_USE_LIGHT_PROBE
</span></span><span style=display:flex><span>    <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec4</span> a_sh_linear_const_r<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec4</span> a_sh_linear_const_g<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec4</span> a_sh_linear_const_b<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span>endif
</span></span><span style=display:flex><span><span style=color:#57606a>#endif</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>#if CC_USE_MORPH</span>
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span><span style=color:#cf222e>if</span> __VERSION__ <span style=color:#0550ae>&lt;</span> <span style=color:#0550ae>450</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>in</span> <span style=color:#cf222e>float</span> a_vertexId<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f6f8fa;background-color:#82071e>#</span>endif
</span></span><span style=display:flex><span><span style=color:#57606a>#endif</span>
</span></span></code></pre></td></tr></table></div></div><p>注意有很多没有显示指定location。此时会被动态绑定。做法：</p><ul><li><strong>搜集已指定的位置</strong>：编译器首先收集所有通过 <code>layout(location = L)</code> 显式指定的变量及其占用的位置范围。</li><li><strong>顺序分配未指定变量：</strong> 对于所有未显式指定 <code>location</code> 的变量，编译器会按照它们在 GLSL 源代码中<strong>声明的顺序</strong>，从 <strong>第一个未被占用的、可用的 <code>location</code> 索引</strong> 开始，顺序地为它们分配位置。</li><li>所以，按照这个规则 <code>a_color</code> 这个变量如果启动（对应的宏打开），那么可能绑定的位置是3、4或者6。</li></ul><h2 id=顶点数据定义>顶点数据定义</h2><p>根据我们在VS中的布局限定：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-glsl data-lang=glsl><span style=display:flex><span>layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec2</span> inPosition<span style=color:#1f2328>;</span> <span style=color:#57606a>// 位置属性，索引为 0</span>
</span></span><span style=display:flex><span>layout<span style=color:#1f2328>(</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>)</span> <span style=color:#cf222e>in</span> <span style=color:#cf222e>vec3</span> inColor<span style=color:#1f2328>;</span>    <span style=color:#57606a>// 颜色属性，索引为 1</span>
</span></span></code></pre></td></tr></table></div></div><p>我们顶点数据也要有这两个分量</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#57606a>#include</span> <span style=color:#57606a>&lt;glm/glm.hpp&gt;</span><span style=color:#57606a>
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#cf222e>struct</span> <span style=color:#1f2328>Vertex</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    glm<span style=color:#0550ae>::</span>vec2 pos<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    glm<span style=color:#0550ae>::</span>vec3 color<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>};</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>const</span> std<span style=color:#0550ae>::</span>vector<span style=color:#0550ae>&lt;</span>Vertex<span style=color:#0550ae>&gt;</span> vertices <span style=color:#0550ae>=</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>{{</span><span style=color:#0550ae>0.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>-</span><span style=color:#0550ae>0.5f</span><span style=color:#1f2328>},</span> <span style=color:#1f2328>{</span><span style=color:#0550ae>1.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0.0f</span><span style=color:#1f2328>}},</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>{{</span><span style=color:#0550ae>0.5f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0.5f</span><span style=color:#1f2328>},</span> <span style=color:#1f2328>{</span><span style=color:#0550ae>0.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>1.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0.0f</span><span style=color:#1f2328>}},</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>{{</span><span style=color:#0550ae>-</span><span style=color:#0550ae>0.5f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0.5f</span><span style=color:#1f2328>},</span> <span style=color:#1f2328>{</span><span style=color:#0550ae>0.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>1.0f</span><span style=color:#1f2328>}}</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>};</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=绑定描述-一组数据的读取方式>绑定描述 (一组数据的读取方式)</h2><p>描述顶点数据：绑定的索引、大小、移动速率（每个顶点移动，或 每个instance移动）</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#57606a>// 描述如何加载顶点数据
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>VkVertexInputBindingDescription <span style=color:#6639ba>getBindingDescription</span><span style=color:#1f2328>()</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    VkVertexInputBindingDescription bindingDescription<span style=color:#1f2328>{};</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#57606a>// binding：顶点缓冲区的索引（如果只有一个 VBO，通常为 0）
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>    bindingDescription<span style=color:#1f2328>.</span>binding <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#57606a>// stride：两个连续顶点之间的字节数，即 Vertex 结构体的大小
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>    bindingDescription<span style=color:#1f2328>.</span>stride <span style=color:#0550ae>=</span> <span style=color:#cf222e>sizeof</span><span style=color:#1f2328>(</span>Vertex<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#57606a>// inputRate：数据速率。VK_VERTEX_INPUT_RATE_VERTEX 表示每读取一个顶点就移动一次
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>    bindingDescription<span style=color:#1f2328>.</span>inputRate <span style=color:#0550ae>=</span> VK_VERTEX_INPUT_RATE_VERTEX<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>return</span> bindingDescription<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=属性描述-单个数据内部的读取方式>属性描述 (单个数据内部的读取方式)</h2><p>因为有两个属性，因此要分别描述两个属性。最终得到属性描述的数组</p><p>第一个属性（location=0）， <code>vec2</code></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>attributeDescriptions<span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>].</span>binding <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>attributeDescriptions<span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>].</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>attributeDescriptions<span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>].</span>format <span style=color:#0550ae>=</span> VK_FORMAT_R32G32_SFLOAT<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>attributeDescriptions<span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>].</span>offset <span style=color:#0550ae>=</span> offsetof<span style=color:#1f2328>(</span>Vertex<span style=color:#1f2328>,</span> pos<span style=color:#1f2328>);</span>
</span></span></code></pre></td></tr></table></div></div><p>第二个属性（location=1)，vec3</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>attributeDescriptions<span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#1f2328>].</span>binding <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>attributeDescriptions<span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#1f2328>].</span>location <span style=color:#0550ae>=</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>attributeDescriptions<span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#1f2328>].</span>format <span style=color:#0550ae>=</span> VK_FORMAT_R32G32B32_SFLOAT<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>attributeDescriptions<span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#1f2328>].</span>offset <span style=color:#0550ae>=</span> offsetof<span style=color:#1f2328>(</span>Vertex<span style=color:#1f2328>,</span> color<span style=color:#1f2328>);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果数据不是float：</p><ul><li><code>ivec2</code> : <code>VK_FORMAT_R32G32_SINT</code></li><li><code>uvec4</code> : <code>VK_FORMAT_R32G32B32A32_UINT</code></li></ul><p>通常，Shader中的数据，长度小于4的数组比较常用，效率较高；而是的枚举可以参考上面的用法。</p><h2 id=pipeline创建时>Pipeline创建时</h2><p>需要在pipeline创建时候，附带这些配置信息</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#cf222e>auto</span> bindingDescription <span style=color:#0550ae>=</span> Vertex<span style=color:#0550ae>::</span>getBindingDescription<span style=color:#1f2328>();</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>auto</span> attributeDescriptions <span style=color:#0550ae>=</span> Vertex<span style=color:#0550ae>::</span>getAttributeDescriptions<span style=color:#1f2328>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>vertexInputInfo<span style=color:#1f2328>.</span>vertexBindingDescriptionCount <span style=color:#0550ae>=</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>vertexInputInfo<span style=color:#1f2328>.</span>vertexAttributeDescriptionCount <span style=color:#0550ae>=</span> <span style=color:#cf222e>static_cast</span><span style=color:#0550ae>&lt;</span><span style=color:#cf222e>uint32_t</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>(</span>attributeDescriptions<span style=color:#1f2328>.</span>size<span style=color:#1f2328>());</span>
</span></span><span style=display:flex><span>vertexInputInfo<span style=color:#1f2328>.</span>pVertexBindingDescriptions <span style=color:#0550ae>=</span> <span style=color:#0550ae>&amp;</span>bindingDescription<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>vertexInputInfo<span style=color:#1f2328>.</span>pVertexAttributeDescriptions <span style=color:#0550ae>=</span> attributeDescriptions<span style=color:#1f2328>.</span>data<span style=color:#1f2328>();</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=顶点缓冲区创建-vertex-buffer-creation>顶点缓冲区创建 (Vertex Buffer Creation)</h1><h2 id=创建buffer对象>创建Buffer对象</h2><p>相对来说比较简单</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>  VkBuffer vertexBuffer<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>void</span> <span style=color:#6639ba>createVertexBuffer</span><span style=color:#1f2328>()</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    VkBufferCreateInfo bufferInfo<span style=color:#1f2328>{};</span>
</span></span><span style=display:flex><span>    bufferInfo<span style=color:#1f2328>.</span>sType <span style=color:#0550ae>=</span> VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    bufferInfo<span style=color:#1f2328>.</span>size <span style=color:#0550ae>=</span> <span style=color:#cf222e>sizeof</span><span style=color:#1f2328>(</span>vertices<span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>])</span> <span style=color:#0550ae>*</span> vertices<span style=color:#1f2328>.</span>size<span style=color:#1f2328>();</span>
</span></span><span style=display:flex><span>    bufferInfo<span style=color:#1f2328>.</span>usage <span style=color:#0550ae>=</span> VK_BUFFER_USAGE_VERTEX_BUFFER_BIT<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    bufferInfo<span style=color:#1f2328>.</span>sharingMode <span style=color:#0550ae>=</span> VK_SHARING_MODE_EXCLUSIVE<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span>vkCreateBuffer<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>bufferInfo<span style=color:#1f2328>,</span> <span style=color:#cf222e>nullptr</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>vertexBuffer<span style=color:#1f2328>)</span> <span style=color:#0550ae>!=</span>
</span></span><span style=display:flex><span>        VK_SUCCESS<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>      <span style=color:#cf222e>throw</span> std<span style=color:#0550ae>::</span>runtime_error<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;failed to create vertex buffer!&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>当然要记得，有创建就有销毁 <code>vkDestroyBuffer(device, vertexBuffer, nullptr);</code></p><p>一些字段解释：</p><ul><li><code>VK_BUFFER_USAGE_VERTEX_BUFFER_BIT</code>：明确告诉 Vulkan，这个缓冲区将用作 <strong>顶点数据</strong> 的来源。</li><li><code>VK_SHARING_MODE_EXCLUSIVE</code>：表示缓冲区将 <strong>只被一个队列族</strong>（例如，只被图形队列）使用。这是最简单和最常见的设置。如果需要在多个队列族（如图形和计算队列）之间共享，则需要使用 <code>VK_SHARING_MODE_CONCURRENT</code></li></ul><p>值得注意的是，<code>vkCreateBuffer</code> <strong>只创建了缓冲区对象本身</strong>，它代表了 GPU 内存中的一个 <strong>区域定义</strong>。它 <strong>并没有</strong> 实际分配 GPU 内存并将顶点数据复制进去。后续步骤通常包括：</p><ol><li>查询内存需求（<code>vkGetBufferMemoryRequirements</code>）。</li><li>分配合适的设备内存（<code>vkAllocateMemory</code>）。</li><li>将缓冲区绑定到分配的内存（<code>vkBindBufferMemory</code>）。</li><li>将实际的顶点数据从 CPU 传输到 GPU 内存中（通常通过 <strong>映射内存</strong> 或 <strong>暂存缓冲区</strong>）。</li></ol><h2 id=内存需求memory-requirements>内存需求(Memory Requirements)</h2><p>Buffer对象还需要绑定内存。获取内存需求：（注意，这步得到的是 <code>memRequirements</code> ）</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>VkMemoryRequirements memRequirements<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>vkGetBufferMemoryRequirements<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> vertexBuffer<span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>memRequirements<span style=color:#1f2328>);</span>
</span></span></code></pre></td></tr></table></div></div><p>这个步骤实际会返回 <code>memRequirements.memoryTypeBits</code> ，这个flag标记了设备上可以支持这个vertexBuffe使用的类型编号。</p><p>在物理设备中，查找合适的内存（符合需求的；不同的内存类型，允许的操作和性能也不一样）。（注意，这步开始查询的则是 <code>memProperties</code>）</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>  <span style=color:#cf222e>uint32_t</span> <span style=color:#6639ba>findMemoryType</span><span style=color:#1f2328>(</span><span style=color:#cf222e>uint32_t</span> typeFilter<span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>                          VkMemoryPropertyFlags properties<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    VkPhysicalDeviceMemoryProperties memProperties<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    vkGetPhysicalDeviceMemoryProperties<span style=color:#1f2328>(</span>physicalDevice<span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>memProperties<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>for</span> <span style=color:#1f2328>(</span><span style=color:#cf222e>uint32_t</span> i <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>;</span> i <span style=color:#0550ae>&lt;</span> memProperties<span style=color:#1f2328>.</span>memoryTypeCount<span style=color:#1f2328>;</span> i<span style=color:#0550ae>++</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>      <span style=color:#cf222e>if</span> <span style=color:#1f2328>((</span>typeFilter <span style=color:#0550ae>&amp;</span> <span style=color:#1f2328>(</span><span style=color:#0550ae>1</span> <span style=color:#0550ae>&lt;&lt;</span> i<span style=color:#1f2328>))</span> <span style=color:#0550ae>&amp;&amp;</span>
</span></span><span style=display:flex><span>          <span style=color:#1f2328>(</span>memProperties<span style=color:#1f2328>.</span>memoryTypes<span style=color:#1f2328>[</span>i<span style=color:#1f2328>].</span>propertyFlags <span style=color:#0550ae>&amp;</span> properties<span style=color:#1f2328>)</span> <span style=color:#0550ae>==</span>
</span></span><span style=display:flex><span>              properties<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>        <span style=color:#cf222e>return</span> i<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>      <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>throw</span> std<span style=color:#0550ae>::</span>runtime_error<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;failed to find suitable memory type!&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>代码解释：</p><ul><li>函数参数：<ul><li>typeFilter： 位掩码。指定了哪些内存类型 <strong>可以</strong> 用于特定的资源（例如，你之前创建的 <code>VkBuffer</code>）。如果第 $i$ 位被设置，则第 $i$ 种内存类型是可用的。<ul><li>这个本身的掩码是由物理设备提供的，由第一步得到。</li></ul></li><li>properties：位掩码。指定你对内存的 <strong>必需属性</strong>，例如内存是否可由 CPU 访问 (可映射)、是否为快速的设备本地内存等。<ul><li>这个我们根据需求来传入，比如<ul><li><code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> ：<strong>主机（CPU）可见。</strong> 允许 CPU 通过 <code>vkMapMemory</code> 直接读写这块内存。</li><li><code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> ：<strong>主机一致性。</strong> 保证 CPU 写入的数据能立即被 GPU 读取，避免手动调用 <code>vkFlushMappedMemoryRanges</code>。通常和上面的标签一起使用。</li></ul></li></ul></li></ul></li><li>函数返回值：可以使用的内存类型索引。</li><li><code>vkGetPhysicalDeviceMemoryProperties</code> : 获取设备内存属性</li><li>循环：遍历和筛选内存类型。<ul><li><code>(typeFilter & (1 &lt;&lt; i)</code> 检查内存类型索引为i的，是否是vertexBuffer可以用的。</li><li><code>(memProperties.memoryTypes[i].propertyFlags & properties) == properties</code> 检查我们传入的必须属性的掩码是否满足。</li></ul></li></ul><h2 id=内存分配memory-allocation>内存分配(Memory Allocation)</h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>    VkMemoryAllocateInfo allocInfo<span style=color:#1f2328>{};</span>
</span></span><span style=display:flex><span>    allocInfo<span style=color:#1f2328>.</span>sType <span style=color:#0550ae>=</span> VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_INFO<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    allocInfo<span style=color:#1f2328>.</span>allocationSize <span style=color:#0550ae>=</span> memRequirements<span style=color:#1f2328>.</span>size<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    allocInfo<span style=color:#1f2328>.</span>memoryTypeIndex <span style=color:#0550ae>=</span>
</span></span><span style=display:flex><span>        findMemoryType<span style=color:#1f2328>(</span>memRequirements<span style=color:#1f2328>.</span>memoryTypeBits<span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>                       VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT <span style=color:#0550ae>|</span>
</span></span><span style=display:flex><span>                           VK_MEMORY_PROPERTY_HOST_COHERENT_BIT<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span>vkAllocateMemory<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>allocInfo<span style=color:#1f2328>,</span> <span style=color:#cf222e>nullptr</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>vertexBufferMemory<span style=color:#1f2328>)</span> <span style=color:#0550ae>!=</span>
</span></span><span style=display:flex><span>        VK_SUCCESS<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>      <span style=color:#cf222e>throw</span> std<span style=color:#0550ae>::</span>runtime_error<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;failed to allocate vertex buffer memory!&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>    vkBindBufferMemory<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> vertexBuffer<span style=color:#1f2328>,</span> vertexBufferMemory<span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>);</span>
</span></span></code></pre></td></tr></table></div></div><p>这个代码比较直观。相当于把之前创建的Buffer对象，分配一个Memory给它。(最后一个代码将allocate的内存绑定给buffer对象)</p><h2 id=填充顶点缓冲区-filling-the-vertex-buffer>填充顶点缓冲区 (Filling the Vertex Buffer)</h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#cf222e>void</span><span style=color:#0550ae>*</span> data<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>vkMapMemory<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> vertexBufferMemory<span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> bufferInfo<span style=color:#1f2328>.</span>size<span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>data<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    memcpy<span style=color:#1f2328>(</span>data<span style=color:#1f2328>,</span> vertices<span style=color:#1f2328>.</span>data<span style=color:#1f2328>(),</span> <span style=color:#1f2328>(</span>size_t<span style=color:#1f2328>)</span> bufferInfo<span style=color:#1f2328>.</span>size<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>vkUnmapMemory<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> vertexBufferMemory<span style=color:#1f2328>);</span>
</span></span></code></pre></td></tr></table></div></div><p>这段代码的目的是将 CPU 内存中存储的顶点数据（在 vertices 容器中）映射到 GPU 可访问的内存区域，然后将数据 复制 过去，最后 解除映射。</p><ul><li><code>vkMapMemory</code> : 这是一个 Vulkan 函数，用于将 <strong>设备内存</strong> (device memory) 映射到应用程序（CPU）的地址空间。（实际：让操作系统将GPU地址映射到进程的虚拟地址空间；操作系统会创建页表、并调用CPU硬件指令告诉CPU这个地址的特殊性：它是I/O设备地址，采用 WC , Write-Combining的方式处理写入，随后到达这个地址的写入指令会被CPU发送到PCIe总线）</li><li><code>memcpy</code> ： 复制，将我们准备好的数据复制到GPU中。（由于复制数据的指令，CPU提前知道了这个地址的特殊性，于是触发了PCIe的总线上数据的发送）</li><li><code>vkUnmapMemory</code> : 这是一个 Vulkan 函数，用于解除对设备内存的映射。</li></ul><p>注意，上面的过程是由于创建显存空间的时候设置了 <code>HOST_COHERENT_BIT</code> 。否则则需要单独的动作来进行上传。</p><h2 id=绑定绘制-binding-the-vertex-buffer>绑定+绘制 (Binding the Vertex Buffer)</h2><p>实际是是一个录制的指令，会绑定到上下文的图形管线上。（图形管线定义了VertexInput)</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>vkCmdBindPipeline<span style=color:#1f2328>(</span>commandBuffer<span style=color:#1f2328>,</span> VK_PIPELINE_BIND_POINT_GRAPHICS<span style=color:#1f2328>,</span> graphicsPipeline<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>VkBuffer vertexBuffers<span style=color:#1f2328>[]</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>{</span>vertexBuffer<span style=color:#1f2328>};</span>
</span></span><span style=display:flex><span>VkDeviceSize offsets<span style=color:#1f2328>[]</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>{</span><span style=color:#0550ae>0</span><span style=color:#1f2328>};</span>
</span></span><span style=display:flex><span>vkCmdBindVertexBuffers<span style=color:#1f2328>(</span>commandBuffer<span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>,</span> vertexBuffers<span style=color:#1f2328>,</span> offsets<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>vkCmdDraw<span style=color:#1f2328>(</span>commandBuffer<span style=color:#1f2328>,</span> <span style=color:#cf222e>static_cast</span><span style=color:#0550ae>&lt;</span><span style=color:#cf222e>uint32_t</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>(</span>vertices<span style=color:#1f2328>.</span>size<span style=color:#1f2328>()),</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>);</span>
</span></span></code></pre></td></tr></table></div></div><p><code>vkCmdBindVertexBuffers(commandBuffer, 0, 1, vertexBuffers, offsets);</code></p><ul><li><code>commandBuffer</code> : 指令写入的buffer</li><li><code>firstBinding</code> (0): <strong>起始绑定点索引。</strong> 它指定了从管线输入的哪个槽位开始绑定缓冲区。通常从 <code>0</code> 开始。这对应于你在管线创建时，<code>VkPipelineVertexInputStateCreateInfo</code> 中定义的 <code>VkVertexInputBindingDescription</code> 数组的索引。 (<strong>这需要对应到正确VertexInputDescription</strong>)</li><li><code>bindingCount</code> (1):<strong>要绑定的缓冲区数量。</strong> 示例中只绑定了一个顶点缓冲区，所以是 <code>1</code>。</li><li><code>pBuffers</code> : <strong>缓冲区数组指针。</strong></li><li><code>pOffsets</code> : <strong>缓冲区偏移量数组指针。</strong> 这是一个与 <code>pBuffers</code> 一一对应的数组，指定从每个缓冲区的哪个字节偏移量开始读取顶点数据。
从接口来说，蛮C语言风格的。</li></ul><p><code>vkCmdDraw(commandBuffer, static_cast&lt;uint32_t>(vertices.size()), 1, 0, 0);</code></p><ul><li><code>commandBuffer</code> : 指令写入的buffer</li><li><code>vertexCount</code> : <strong>要绘制的顶点数量。</strong> 这指示了管线应该处理多少个顶点数据。在你的示例中，它等于 <code>vertices</code> 数组中元素的总数。</li><li><code>instanceCount</code>: <strong>实例化数量。</strong> 表示要重复绘制的次数。<code>1</code> 表示只绘制一次。如果这个值大于 1，GPU 会将同样的几何体绘制多次，这常用于批量渲染相同的对象（如粒子、草地）。</li><li><code>firstVertex</code> : <strong>起始顶点索引。</strong> 这是在顶点缓冲区中开始读取数据的索引。<code>0</code> 表示从数组的第一个顶点开始。</li><li><code>firstInstance</code>: <strong>起始实例化索引。</strong> 通常为 <code>0</code></li></ul><p>这是一个<strong>非索引绘制 (Non-Indexed Draw)</strong> 命令。这意味着 Vulkan 会按顺序读取顶点缓冲区中的数据，每 $N$ 个顶点（由图元拓扑决定，如 3 个顶点组成一个三角形）构成一个图元，然后绘制它。</p><p><strong>绘制动作实际的逻辑操作取决于InputAssembly环节的设置</strong></p><p>比如InputAssembly设置了三角形带。实际是定义了一种组合模式，类似 <code>0,1,2;1,2,3;....</code> 这样的组合模式，来组成图元。<strong>InputAssembly实际决定的是 <code>0,1,2;1,2,3;</code> 这种组合模式，也即拓扑规则</strong> 。更具体来说：（如果InputAssembly中设置了三角形）</p><ul><li>非索引绘制。 <code>V_0,V_1,V_2</code> 组成三角形（按照组合模式，直接取顶点）</li><li>索引绘制。 <code>V_I0,V_I1,V_I2</code> 组成三角形 （按照组合模式，先取索引，再取顶点）</li></ul><h2 id=效果展示>效果展示</h2><p>到这里，前两节如果都按照教程操作成功，那么可以正常绘制三角形。
<img src=/images/Vulkan%E5%85%A5%E9%97%A802-VertexBuffers-1764249822704.png loading=lazy alt=Vulkan入门02-VertexBuffers-1764249822704></p><h1 id=暂存缓冲区staging-buffer>暂存缓冲区(Staging Buffer)</h1><p>我们创建的显存，properties指定的是：</p><pre tabindex=0><code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT | VK_MEMORY_PROPERTY_HOST_COHERENT_BIT
</code></pre><p>这不是最有效率的显存。最有效率的是 <code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> ，但通常CPU无法访问。</p><p>本小节优化这个部分。创建两个 Vertex Vuffer。</p><ul><li><code>staging buffer</code> : 让CPU方便访问的。（我们把数据复制到这里）</li><li><code>final vertex buffer</code> : 选择更有效率的显存。（调用指令，将数据从staging buffer传输到 final vertex buffer）</li></ul><h2 id=传输队列transfer-queue>传输队列(Transfer queue)</h2><p>我们描述的传输操作，需要专门的队列来支持（显卡特性）。不过具备 <code>VK_QUEUE_GRAPHICS_BIT</code> 或者 <code>VK_QUEUE_COMPUTE_BIT</code> 的队列能力的，默认支持 <code>VK_QUEUE_TRANSFER_BIT</code> 这个能力。</p><h2 id=重构>重构</h2><p>把创建Buffer单独分离出一个函数</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#cf222e>void</span> <span style=color:#6639ba>createBuffer</span><span style=color:#1f2328>(</span>VkDeviceSize size<span style=color:#1f2328>,</span> VkBufferUsageFlags usage<span style=color:#1f2328>,</span> VkMemoryPropertyFlags properties<span style=color:#1f2328>,</span> VkBuffer<span style=color:#0550ae>&amp;</span> buffer<span style=color:#1f2328>,</span> VkDeviceMemory<span style=color:#0550ae>&amp;</span> bufferMemory<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    VkBufferCreateInfo bufferInfo<span style=color:#1f2328>{};</span>
</span></span><span style=display:flex><span>    bufferInfo<span style=color:#1f2328>.</span>sType <span style=color:#0550ae>=</span> VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    bufferInfo<span style=color:#1f2328>.</span>size <span style=color:#0550ae>=</span> size<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    bufferInfo<span style=color:#1f2328>.</span>usage <span style=color:#0550ae>=</span> usage<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    bufferInfo<span style=color:#1f2328>.</span>sharingMode <span style=color:#0550ae>=</span> VK_SHARING_MODE_EXCLUSIVE<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span>vkCreateBuffer<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>bufferInfo<span style=color:#1f2328>,</span> <span style=color:#cf222e>nullptr</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>buffer<span style=color:#1f2328>)</span> <span style=color:#0550ae>!=</span> VK_SUCCESS<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>        <span style=color:#cf222e>throw</span> std<span style=color:#0550ae>::</span>runtime_error<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;failed to create buffer!&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    VkMemoryRequirements memRequirements<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    vkGetBufferMemoryRequirements<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> buffer<span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>memRequirements<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    VkMemoryAllocateInfo allocInfo<span style=color:#1f2328>{};</span>
</span></span><span style=display:flex><span>    allocInfo<span style=color:#1f2328>.</span>sType <span style=color:#0550ae>=</span> VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_INFO<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    allocInfo<span style=color:#1f2328>.</span>allocationSize <span style=color:#0550ae>=</span> memRequirements<span style=color:#1f2328>.</span>size<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    allocInfo<span style=color:#1f2328>.</span>memoryTypeIndex <span style=color:#0550ae>=</span> findMemoryType<span style=color:#1f2328>(</span>memRequirements<span style=color:#1f2328>.</span>memoryTypeBits<span style=color:#1f2328>,</span> properties<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span>vkAllocateMemory<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>allocInfo<span style=color:#1f2328>,</span> <span style=color:#cf222e>nullptr</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>bufferMemory<span style=color:#1f2328>)</span> <span style=color:#0550ae>!=</span> VK_SUCCESS<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>        <span style=color:#cf222e>throw</span> std<span style=color:#0550ae>::</span>runtime_error<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;failed to allocate buffer memory!&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    vkBindBufferMemory<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> buffer<span style=color:#1f2328>,</span> bufferMemory<span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>);</span> <span style=color:#57606a>// 0代表偏移量
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=使用暂存缓冲区>使用暂存缓冲区</h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>  <span style=color:#cf222e>void</span> <span style=color:#6639ba>createVertexBuffer</span><span style=color:#1f2328>()</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    VkDeviceSize bufferSize <span style=color:#0550ae>=</span> <span style=color:#cf222e>sizeof</span><span style=color:#1f2328>(</span>vertices<span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>])</span> <span style=color:#0550ae>*</span> vertices<span style=color:#1f2328>.</span>size<span style=color:#1f2328>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    VkBuffer stagingBuffer<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    VkDeviceMemory stagingBufferMemory<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    createBuffer<span style=color:#1f2328>(</span>bufferSize<span style=color:#1f2328>,</span> VK_BUFFER_USAGE_VERTEX_BUFFER_BIT<span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>                 VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT <span style=color:#0550ae>|</span>
</span></span><span style=display:flex><span>                     VK_MEMORY_PROPERTY_HOST_COHERENT_BIT<span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>                 stagingBuffer<span style=color:#1f2328>,</span> stagingBufferMemory<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>void</span> <span style=color:#0550ae>*</span>data<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    vkMapMemory<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> stagingBufferMemory<span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> bufferSize<span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>data<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    memcpy<span style=color:#1f2328>(</span>data<span style=color:#1f2328>,</span> vertices<span style=color:#1f2328>.</span>data<span style=color:#1f2328>(),</span> <span style=color:#1f2328>(</span>size_t<span style=color:#1f2328>)</span>bufferSize<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    vkUnmapMemory<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> stagingBufferMemory<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    createBuffer<span style=color:#1f2328>(</span>bufferSize<span style=color:#1f2328>,</span> VK_BUFFER_USAGE_VERTEX_BUFFER_BIT<span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>                 VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT<span style=color:#1f2328>,</span> vertexBuffer<span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>                 vertexBufferMemory<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    copyBuffer<span style=color:#1f2328>(</span>stagingBuffer<span style=color:#1f2328>,</span> vertexBuffer<span style=color:#1f2328>,</span> bufferSize<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    vkDestroyBuffer<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> stagingBuffer<span style=color:#1f2328>,</span> <span style=color:#cf222e>nullptr</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    vkFreeMemory<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> stagingBufferMemory<span style=color:#1f2328>,</span> <span style=color:#cf222e>nullptr</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>显然，创建了两块显存。一个是用来作为 StagingBuffer要求CPU可见。另一个用来作为，VertexBuffer，要求性能更好。同时再用途上执行了一个为src，另一个为dst+VertexBuffer</p><p>接下来实现buffer传输的功能</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>  <span style=color:#cf222e>void</span> <span style=color:#6639ba>copyBuffer</span><span style=color:#1f2328>(</span>VkBuffer srcBuffer<span style=color:#1f2328>,</span> VkBuffer dstBuffer<span style=color:#1f2328>,</span> VkDeviceSize size<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    VkCommandBufferAllocateInfo allocInfo<span style=color:#1f2328>{};</span>
</span></span><span style=display:flex><span>    allocInfo<span style=color:#1f2328>.</span>sType <span style=color:#0550ae>=</span> VK_STRUCTURE_TYPE_COMMAND_BUFFER_ALLOCATE_INFO<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    allocInfo<span style=color:#1f2328>.</span>level <span style=color:#0550ae>=</span> VK_COMMAND_BUFFER_LEVEL_PRIMARY<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    allocInfo<span style=color:#1f2328>.</span>commandPool <span style=color:#0550ae>=</span> commandPool<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    allocInfo<span style=color:#1f2328>.</span>commandBufferCount <span style=color:#0550ae>=</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    VkCommandBuffer commandBuffer<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    vkAllocateCommandBuffers<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>allocInfo<span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>commandBuffer<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    VkCommandBufferBeginInfo beginInfo<span style=color:#1f2328>{};</span>
</span></span><span style=display:flex><span>    beginInfo<span style=color:#1f2328>.</span>sType <span style=color:#0550ae>=</span> VK_STRUCTURE_TYPE_COMMAND_BUFFER_BEGIN_INFO<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    beginInfo<span style=color:#1f2328>.</span>flags <span style=color:#0550ae>=</span> VK_COMMAND_BUFFER_USAGE_ONE_TIME_SUBMIT_BIT<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    vkBeginCommandBuffer<span style=color:#1f2328>(</span>commandBuffer<span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>beginInfo<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    VkBufferCopy copyRegion<span style=color:#1f2328>{};</span>
</span></span><span style=display:flex><span>    copyRegion<span style=color:#1f2328>.</span>srcOffset <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>;</span> <span style=color:#57606a>// Optional
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>    copyRegion<span style=color:#1f2328>.</span>dstOffset <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>;</span> <span style=color:#57606a>// Optional
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>    copyRegion<span style=color:#1f2328>.</span>size <span style=color:#0550ae>=</span> size<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    vkCmdCopyBuffer<span style=color:#1f2328>(</span>commandBuffer<span style=color:#1f2328>,</span> srcBuffer<span style=color:#1f2328>,</span> dstBuffer<span style=color:#1f2328>,</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>copyRegion<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    VkSubmitInfo submitInfo<span style=color:#1f2328>{};</span>
</span></span><span style=display:flex><span>    submitInfo<span style=color:#1f2328>.</span>sType <span style=color:#0550ae>=</span> VK_STRUCTURE_TYPE_SUBMIT_INFO<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    submitInfo<span style=color:#1f2328>.</span>commandBufferCount <span style=color:#0550ae>=</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    submitInfo<span style=color:#1f2328>.</span>pCommandBuffers <span style=color:#0550ae>=</span> <span style=color:#0550ae>&amp;</span>commandBuffer<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    vkQueueSubmit<span style=color:#1f2328>(</span>graphicsQueue<span style=color:#1f2328>,</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>submitInfo<span style=color:#1f2328>,</span> VK_NULL_HANDLE<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    vkQueueWaitIdle<span style=color:#1f2328>(</span>graphicsQueue<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    vkFreeCommandBuffers<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> commandPool<span style=color:#1f2328>,</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>commandBuffer<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>实际上和渲染类似，我们需要把指令提交给传输队列，等待传输队列idle（等待执行完毕）</p><h2 id=总结>总结</h2><p>目前代码为每一个Buffer都执行了 <code>vkAllocateMemory</code> 。实际我们不会这么做，而是创建一个大的，然后自己管理offset。因为设备通常不允许创建很多的buffer。</p><h1 id=索引缓冲区index-buffer>索引缓冲区(Index Buffer)</h1><h2 id=创建ib数据>创建IB数据</h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#cf222e>const</span> std<span style=color:#0550ae>::</span>vector<span style=color:#0550ae>&lt;</span>Vertex<span style=color:#0550ae>&gt;</span> vertices <span style=color:#0550ae>=</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>{{</span><span style=color:#0550ae>-</span><span style=color:#0550ae>0.5f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>-</span><span style=color:#0550ae>0.5f</span><span style=color:#1f2328>},</span> <span style=color:#1f2328>{</span><span style=color:#0550ae>1.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0.0f</span><span style=color:#1f2328>}},</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>{{</span><span style=color:#0550ae>0.5f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>-</span><span style=color:#0550ae>0.5f</span><span style=color:#1f2328>},</span> <span style=color:#1f2328>{</span><span style=color:#0550ae>0.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>1.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0.0f</span><span style=color:#1f2328>}},</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>{{</span><span style=color:#0550ae>0.5f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0.5f</span><span style=color:#1f2328>},</span> <span style=color:#1f2328>{</span><span style=color:#0550ae>0.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>1.0f</span><span style=color:#1f2328>}},</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>{{</span><span style=color:#0550ae>-</span><span style=color:#0550ae>0.5f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0.5f</span><span style=color:#1f2328>},</span> <span style=color:#1f2328>{</span><span style=color:#0550ae>1.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>1.0f</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>1.0f</span><span style=color:#1f2328>}}</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>};</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>const</span> std<span style=color:#0550ae>::</span>vector<span style=color:#0550ae>&lt;</span><span style=color:#cf222e>uint16_t</span><span style=color:#0550ae>&gt;</span> indices <span style=color:#0550ae>=</span> <span style=color:#1f2328>{</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>2</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>2</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>3</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span> <span style=color:#1f2328>};</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=创建-indexbuffer>创建 IndexBuffer</h2><p>相对容易，类似VertexBuffer。但不需要太多配置。直接创建即可。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#cf222e>void</span> <span style=color:#6639ba>createIndexBuffer</span><span style=color:#1f2328>()</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    VkDeviceSize bufferSize <span style=color:#0550ae>=</span> <span style=color:#cf222e>sizeof</span><span style=color:#1f2328>(</span>indices<span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>])</span> <span style=color:#0550ae>*</span> indices<span style=color:#1f2328>.</span>size<span style=color:#1f2328>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    VkBuffer stagingBuffer<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    VkDeviceMemory stagingBufferMemory<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    createBuffer<span style=color:#1f2328>(</span>bufferSize<span style=color:#1f2328>,</span> VK_BUFFER_USAGE_TRANSFER_SRC_BIT<span style=color:#1f2328>,</span> VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT <span style=color:#0550ae>|</span> VK_MEMORY_PROPERTY_HOST_COHERENT_BIT<span style=color:#1f2328>,</span> stagingBuffer<span style=color:#1f2328>,</span> stagingBufferMemory<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>void</span><span style=color:#0550ae>*</span> data<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    vkMapMemory<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> stagingBufferMemory<span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> bufferSize<span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>data<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    memcpy<span style=color:#1f2328>(</span>data<span style=color:#1f2328>,</span> indices<span style=color:#1f2328>.</span>data<span style=color:#1f2328>(),</span> <span style=color:#1f2328>(</span>size_t<span style=color:#1f2328>)</span> bufferSize<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    vkUnmapMemory<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> stagingBufferMemory<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    createBuffer<span style=color:#1f2328>(</span>bufferSize<span style=color:#1f2328>,</span> VK_BUFFER_USAGE_TRANSFER_DST_BIT <span style=color:#0550ae>|</span> VK_BUFFER_USAGE_INDEX_BUFFER_BIT<span style=color:#1f2328>,</span> VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT<span style=color:#1f2328>,</span> indexBuffer<span style=color:#1f2328>,</span> indexBufferMemory<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    copyBuffer<span style=color:#1f2328>(</span>stagingBuffer<span style=color:#1f2328>,</span> indexBuffer<span style=color:#1f2328>,</span> bufferSize<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    vkDestroyBuffer<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> stagingBuffer<span style=color:#1f2328>,</span> <span style=color:#cf222e>nullptr</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    vkFreeMemory<span style=color:#1f2328>(</span>device<span style=color:#1f2328>,</span> stagingBufferMemory<span style=color:#1f2328>,</span> <span style=color:#cf222e>nullptr</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=使用indexbuffer>使用IndexBuffer</h2><p>相对容易，绘制前，绑定一下。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>vkCmdBindVertexBuffers<span style=color:#1f2328>(</span>commandBuffer<span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>,</span> vertexBuffers<span style=color:#1f2328>,</span> offsets<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>vkCmdBindIndexBuffer<span style=color:#1f2328>(</span>commandBuffer<span style=color:#1f2328>,</span> indexBuffer<span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> VK_INDEX_TYPE_UINT16<span style=color:#1f2328>);</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>注意这里的数据类型，要指定对。</li></ul><p>绘制使用新的命令。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>vkCmdDrawIndexed<span style=color:#1f2328>(</span>commandBuffer<span style=color:#1f2328>,</span> <span style=color:#cf222e>static_cast</span><span style=color:#0550ae>&lt;</span><span style=color:#cf222e>uint32_t</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>(</span>indices<span style=color:#1f2328>.</span>size<span style=color:#1f2328>()),</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=效果>效果</h2><img src=/images/Vulkan%E5%85%A5%E9%97%A802-VertexBuffers-1764252524778.png alt=Vulkan入门02-VertexBuffers-1764252524778 width=574x430 loading=lazy></section><footer class=article-footer><section class=article-tags><a href=/tags/vulkan/>Vulkan</a>
<a href=/tags/vertexbuffer/>Vertexbuffer</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=[".main-article",".widget--toc"];e.forEach(e=>{const t=document.querySelector(e);t&&renderMathInElement(t,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/2025/11/21/vulkan%E7%A8%8B%E5%BA%8F%E4%B8%ADintel%E9%A9%B1%E5%8A%A8%E6%80%BB%E6%98%AF%E8%A2%AB%E8%B0%83%E7%94%A8%E6%9C%AA%E8%A7%A3%E5%86%B3/><div class=article-details><h2 class=article-title>Vulkan程序中Intel驱动总是被调用（未解决）</h2></div></a></article><article><a href=/2025/11/19/vulkan%E7%9A%84layer%E5%8F%91%E7%8E%B0%E6%9C%BA%E5%88%B6/><div class=article-details><h2 class=article-title>Vulkan的Layer发现机制</h2></div></a></article><article><a href=/2025/11/18/vulkan%E7%9A%84icd%E6%9C%BA%E5%88%B6/><div class=article-details><h2 class=article-title>Vulkan的ICD机制</h2></div></a></article><article><a href=/2025/11/17/%E8%AE%B0%E5%BD%95%E8%B0%83%E8%AF%95vulkan%E7%A8%8B%E5%BA%8F%E6%89%93%E5%8D%B0%E5%A5%87%E6%80%AA%E6%97%A5%E5%BF%97%E7%9A%84%E9%97%AE%E9%A2%98/><div class=article-details><h2 class=article-title>记录调试Vulkan程序打印奇怪日志的问题</h2></div></a></article><article><a href=/2025/11/11/vulkan%E5%85%A5%E9%97%A801-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/><div class=article-details><h2 class=article-title>Vulkan入门01-绘制三角形</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2025 crackhopper的技术博客</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.32.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.0fcb739c1f88ce461c9640077fd21d8ce903946f1aef209dd01192827d26a90c.js defer></script><script type=text/javascript src=/ts/custom.fb6397326fc458b8ae775aee18e0a0ae80628aec9c216e7e90c79bb0486cb0e3.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>